
namespace = SNB

###BORROWING/DONATING MONEY###

character_event = {
	id = SNB.6000
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		save_event_target_as = grand_master
		FROM = { letter_event = { id = SNB.6001 } }
	}
}

###JOINING & RECRUITMENT EVENTS###

#Talking about fighting for the faith, reaction
character_event = {
	id = SNB.6022
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_diplomacy
	text = EVTDESC_SNB_6022_A
	
	

	is_triggered_only = yes

	immediate = {
		if = { 
			limit = { NOT = { event_target:shinobi_recruiter = { always = yes } } }
			FROMFROM = { save_event_target_as = shinobi_recruiter }
			save_event_target_as = shinobi_recruitee
		}
	}
	
	#Willing to join
	option = {
		name = EVTOPTA_6022
		
		reverse_opinion = {
			who = event_target:shinobi_recruiter
			modifier = opinion_honorable
			years = 5
		}

		set_character_flag = willing_to_join
		
		hidden_effect = { event_target:shinobi_recruiter = { character_event = { id = SNB.6023 days = 1 } } }
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 3
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				has_education_intrigue_trigger = yes
			}
			modifier = {
				factor = 1.5
				has_lifestyle_intrigue_trigger = yes
			}
			modifier = {
				factor = 1.5
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 1.5
				FROM = { intrigue = 12 }
			}
			modifier = {
				factor = 10
				has_character_flag = was_trained_as_shinobi_protege
			}
		}
	}

	#Not willing to join
	option = {
		name = EVTOPTB_6022
		
		reverse_opinion = {
			who = event_target:shinobi_recruiter
			modifier = opinion_lacks_conviction
			years = 5
		}

		set_character_flag = unwilling_to_join
		
		hidden_effect = { event_target:shinobi_recruiter = { character_event = { id = SNB.6023 days = 1 } } }
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				true_religion_shiite_trigger = no
			}
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { intrigue = 8 } }
			}
		}
	}
}

#Wants to join? Make the offer
character_event = {
	id = SNB.6023
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { FROM = { has_character_flag = willing_to_join } }
		text = EVTDESC_SNB_6023_A
	}
	desc = {
		trigger = { FROM = { has_character_flag = unwilling_to_join } }
		text = EVTDESC_SNB_6023_B
	}

	is_triggered_only = yes

	#Pose the question
	option = {
		trigger = { FROM = { has_character_flag = willing_to_join } }
		name = EVTOPTA_6023
		custom_tooltip = { text = EVTOPTA_6023_TOOLTIP }

		hidden_effect = {
			FROM = {
				character_event = { id = SNB.6024 days = 1 }
				clr_character_flag = willing_to_join
			}
		}

		ai_chance = { factor = 100 }
	}

	#Too risky, end
	option = {
		trigger = { FROM = { has_character_flag = willing_to_join } }
		name = EVTOPTB_6023
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = willing_to_join } }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
		ai_chance = { factor = 0 }
	}

	#Not interested, end
	option = {
		trigger = { FROM = { has_character_flag = unwilling_to_join } }
		name = EVTOPTC_6023
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = unwilling_to_join } }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
	}
}

#Offer to join, yes or no?
character_event = {
	id = SNB.6024
	picture = GFX_evt_shady_meeting
	desc = {
		trigger = {
			NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		}
		text = EVTDESC_SNB_6024_A
	}
	desc = {
		trigger = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
		text = EVTDESC_SNB_6024_B
	}
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	#Yes
	option = {
		name = EVTOPTA_6024
		custom_tooltip = { text = EVTOPTA_6024_TOOLTIP }

		hidden_effect = { event_target:shinobi_recruiter = { character_event = { id = SNB.6026 days = 1 } } }
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				has_character_flag = was_trained_as_assassin_protege
			}
		}
	}

	#No
	option = {
		name = EVTOPTB_6024
		custom_tooltip = { text = EVTOPTB_6024_TOOLTIP }

		hidden_effect = { event_target:shinobi_recruiter = { character_event = { id = SNB.6025 days = 1 } } }

		ai_chance = {
			factor = 10
		}
	}
}

#Recruit said no
character_event = {
	id = SNB.6025
	picture = GFX_evt_quarrel
	desc = EVTDESC_SNB_6025
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6025
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
	}
}

#Recruit said yes 
character_event = {
	id = SNB.6026
	picture = GFX_evt_whispers
	desc = EVTDESC_SNB_6026
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_new = yes

	immediate = {
		if = {
			limit = {
				NOT = {
					any_society_member = {
						society_rank = {
							society = the_shinobi
							rank == 3
						}
					}
				}
			}
			random_society_member = {
				limit = {
					society_rank = {
						society = the_shinobi
						rank == 4
					}
				}
				create_character = {
					age = 30
					female = no
					random_traits = no
					dynasty = random
					trait = elusive_shadow
					trait = patient
					trait = zealous
					trait = scholar
					trait = chaste
					trait = temperate
				}
				new_character = {
					join_society = the_shinobi
					society_rank_up = {
						rank = 2
						society = the_shinobi
					}
					if = {
						limit = { NOT = { religion = nihon_shinto } }
						set_secret_religion = nihon_shinto
					}
				}
			}
		}

		random_society_member = { 
			limit = { 
				society_rank = {
					society = the_shinobi
					rank == 3
				}
			}
			save_event_target_as = shinobi_inductor
		}
	}

	option = {
		name = EVTOPTA_6026
		custom_tooltip = { text = EVTOPTA_6026_TOOLTIP }

		hidden_effect = { FROM = { character_event = { id = SNB.6027 days = 1 } } }
	}
}

#Confirmation for recruit
character_event = {
	id = SNB.6027
	picture = GFX_evt_whispers
	desc = {
		trigger = {
			NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		}
		text = EVTDESC_SNB_6027_A
	}
	desc = {
		trigger = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
		text = EVTDESC_SNB_6027_B
	}
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6027
		custom_tooltip = { text = EVTOPTA_6027_TOOLTIP }

		hidden_effect = { 
			character_event = { id = SNB.6028 days = 14 random = 7 } 
		}
	}
}

#Joining begins
character_event = {
	id = SNB.6028
	picture = GFX_evt_shadow
	desc = {
		trigger = {
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		text = EVTDESC_SNB_6028		
	}
	desc = {
		trigger = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
		text = EVTDESC_SNB_6028_ALT		
	}
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_society_member = {
				limit = { 
					society_rank = {
						rank == 4
						society = the_shinobi
					}
				}
				save_event_target_as = grand_master
			}
		}
		set_character_flag = shinobi_attempted_recruitment
	}
	#Allahu akbar!
	option = {
		name = {
			trigger = {
				NOT = {
					has_alternate_start_parameter = { key = religion_names value = random }
				}
			}
			text = EVTOPTA_6028_B
		}
		name = {
			trigger = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
			text = EVTOPTA_6028_ALT
		}
		
		if = {
			limit = {
				NOT = {
					has_alternate_start_parameter = { key = religion_names value = random }
				}
			}
			custom_tooltip = { text = EVTOPTA_6028_TOOLTIP }
		}

		hidden_effect = { character_event = { id = SNB.6029 days = 1 } }
	}

}

#Sign written delcaration of loyalty to grand master
character_event = {
	id = SNB.6029
	picture = GFX_evt_shadow
	desc = EVTDESC_SNB_6029
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	#Yes
	option = {
		name = EVTOPTA_6029
		custom_tooltip = { text = EVTOPTA_6029_TOOLTIP }

		hidden_effect = { character_event = { id = SNB.6030 days = 1 } }

		ai_chance = {
			factor = 100
		}
	}

	#No
	option = {
		name = EVTOPTB_6029
		custom_tooltip = { text = EVTOPTB_6029_TOOLTIP }

		hidden_effect = { 
			FROM = { character_event = { id = SNB.6039 days = 3 } } #Fail

			if = {
				limit = { event_target:shinobi_recruiter = { always = yes } }
				event_target:shinobi_recruiter = { set_character_flag = recruitment_fail }
				event_target:grand_master = { character_event = { id = SNB.6040 } } 
			}
		} 

		ai_chance = {
			factor = 0
		}
	}
}

#Inductor will get in contact with you
character_event = {
	id = SNB.6030
	picture = GFX_evt_shadow
	desc = EVTDESC_SNB_6030
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6030
		custom_tooltip = { text = EVTOPTA_6030_TOOLTIP }

		hidden_effect = { character_event = { id = SNB.6031 days = 30 random = 6 } } 
	}
}

#Sending event to inductor
character_event = {
	id = SNB.6031
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = { 
			limit = { NOT = { event_target:shinobi_inductor = { is_alive = yes } } }

			if = {
				limit = {
					NOT = {
						any_society_member = { 
							society_rank = {
								society = the_shinobi
								rank == 3
							}
						}
					}
				}
				random_society_member = { 
					limit = {
						society_rank = {
							society = the_shinobi
							rank == 4
						}
					}
		
					create_character = {
						age = 30
						female = no
						random_traits = no
						dynasty = random
						trait = elusive_shadow
						trait = patient
						trait = zealous
						trait = scholar
						trait = chaste
						trait = temperate
					}
					new_character = {
						join_society = the_shinobi
						society_rank_up = {
							rank = 2
							society = the_shinobi
						}
						if = {
							limit = { NOT = { religion = nihon_shinto } }
							set_secret_religion = nihon_shinto
						}
					}
				}
			}
			random_society_member = { 
				limit = { 
					society_rank = {
						society = the_shinobi
						rank == 3
					}
				}
				save_event_target_as = shinobi_inductor
			}	
		}
		event_target:shinobi_inductor = { 
			set_character_flag = event_SNB_6033
			character_event = { id = SNB.6032 } 
		}
	}
}

#Ping event for inductor
character_event = {
	id = SNB.6032
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { is_alive = no }
			FROM = { character_event = { id = SNB.7030 days = 10 } }
			break = yes
		}
		trigger_switch = {
			on_trigger = has_character_flag
			event_SNB_6033 = { FROM = { letter_event = { id = SNB.6033 } } }
			event_SNB_6034 = { FROM = { character_event = { id = SNB.6034 days = 14 } } }
			event_SNB_6035 = { FROM = { character_event = { id = SNB.6035 days = 3 } } }
			event_SNB_6036 = { FROM = { character_event = { id = SNB.6036 days = 5 } } }
			event_SNB_6037 = { FROM = { character_event = { id = SNB.6037 days = 1 } } }
			event_SNB_6038 = { FROM = { character_event = { id = SNB.6038 days = 1 } } }
		}
		clr_character_flag = event_SNB_6033
		clr_character_flag = event_SNB_6034
		clr_character_flag = event_SNB_6035
		clr_character_flag = event_SNB_6036
		clr_character_flag = event_SNB_6037
		clr_character_flag = event_SNB_6038
	}
}

#Invitation to stronghold
letter_event = {
	id = SNB.6033
	desc = EVTDESC_SNB_6033
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	immediate = {
		FROM = { host = { capital_holding = { save_event_target_as = inductor_rendezvous } } }

		FROM = { 
			host = { capital_holding = { save_event_target_as = inductor_rendezvous } } }

		random_independent_ruler = {
			limit = {
				any_demesne_title = { title = d_hashshashin }
				society_member_of = the_shinobi
			}
			capital_holding = { save_event_target_as = inductor_rendezvous }
		}
	}

	option = {
		name = EVTOPTA_6033
		custom_tooltip = { text = EVTOPTA_6033_TOOLTIP }

		hidden_effect = {
			event_target:shinobi_inductor = { 
				clr_character_flag = event_SNB_6033
				set_character_flag = event_SNB_6034
				character_event = { id = SNB.6032 } 
			}
		}
	}
}

#Welcome by GM
character_event = {
	id = SNB.6034
	picture = GFX_evt_magnificent_castle
	desc = EVTDESC_SNB_6034
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6034

		hidden_effect = {
			event_target:shinobi_inductor = { 
				clr_character_flag = event_SNB_6034
				set_character_flag = event_SNB_6035
				character_event = { id = SNB.6032 }
			}
		}
	}
}

#Secret ritual
character_event = {
	id = SNB.6035
	picture = GFX_evt_into_the_dungeon
	desc = EVTDESC_SNB_6035
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6035

		hidden_effect = {
			event_target:shinobi_inductor = { 
				clr_character_flag = event_SNB_6035
				set_character_flag = event_SNB_6036
				character_event = { id = SNB.6032 } 
			}
		}
	}
}

#Kill to prove
character_event = {
	id = SNB.6036
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:shinobi_sacrifice = { always = yes } }
		text = EVTDESC_SNB_6036_A
	}
	desc = {
		trigger = { NOT = { event_target:shinobi_sacrifice = { always = yes } } }
		text = EVTDESC_SNB_6036_B
	}

	is_triggered_only = yes
	
	immediate = {
		random_courtier_or_vassal = {
			limit = { 
				NOT = { society_member_of = the_shinobi }
				trait = cynical 
				religion = nihon_shinto
				is_adult = yes
				ai = yes
			}
			save_event_target_as = shinobi_sacrifice
		}
		random_courtier_or_vassal = {
			limit = { 
				NOT = { society_member_of = the_shinobi }
				true_religion_shiite_trigger = no 
				is_adult = yes
				ai = yes
			}
			save_event_target_as = shinobi_sacrifice
		}
		random_courtier_or_vassal = {
			limit = {
				NOT = { society_member_of = the_shinobi }
				true_religion_shiite_trigger = no
				trait = zealous
				is_adult = yes
				ai = yes
			}
			save_event_target_as = shinobi_sacrifice
		}
		random_courtier_or_vassal = {
			limit = {
				NOT = { society_member_of = the_shinobi }
				is_primary_heir = no
				OR = {
					is_lover = ROOT
					is_friend = ROOT
					is_close_relative = ROOT
				}
				OR = {
					true_religion_shiite_trigger = no
					trait = cynical
				}
				is_adult = yes
				ai = yes
			}
			save_event_target_as = shinobi_sacrifice
		}
	}

	#do it
	option = {
		name = EVTOPTA_6036

		if = {
			limit = { event_target:shinobi_sacrifice = { always = yes } }
			event_target:shinobi_sacrifice = { death = { death_reason = death_murder_unknown killer = ROOT } }
		}
		if = {
			limit = { NOT = { event_target:shinobi_sacrifice = { always = yes } } }
			custom_tooltip = { text = EVTOPTA_6036_TOOLTIP }
		}

		hidden_effect = {
			event_target:shinobi_inductor = { 
				clr_character_flag = event_SNB_6036
				set_character_flag = event_SNB_6037
				character_event = { id = SNB.6032 } 
			}
		}

		ai_chance = { factor = 100 }
	}

	#don't do it, fight your way out
	option = {
		name = EVTOPTB_6036
		custom_tooltip = { text = EVTOPTB_6036_TOOLTIP }
		
		hidden_effect = { 
			random_list = {
				#Getaway
				33 = {
					set_character_flag = escape_successful

					if = { #Saves root for loc nouns
						limit = { NOT = { event_target:shinobi_sacrifice = { always = yes } } }
						save_event_target_as = shinobi_sacrifice
					}

					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 2 }
					}
					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 4 }
					}
					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 6 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 10 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 20 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 30 }
					}
				}
				#Injured
				33 = {
					set_character_flag = escape_injured
				}
				#Death
				33 = {
					set_character_flag = escape_death
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
					}
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
					}
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 10 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 20 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 30 } }
					}
				}
			}

			event_target:shinobi_inductor = { 
				clr_character_flag = event_SNB_6036
				set_character_flag = event_SNB_6038
				character_event = { id = SNB.6032 } 
			}
		}

		ai_chance = { factor = 0 }
	}

	#bribe
	option = {
		trigger = { diplomacy = 12 }
		tooltip_info = diplomacy

		name = EVTOPTC_6036
		custom_tooltip = { text = EVTOPTC_6036_TOOLTIP }

		scaled_wealth = { value = -0.5 min = -100 }

		hidden_effect = {
			set_character_flag = escape_bribe 
			event_target:shinobi_inductor = { 
				clr_character_flag = event_SNB_6036
				set_character_flag = event_SNB_6038
				character_event = { id = SNB.6032 } 
			}
		}
		ai_chance = { factor = 0 }
	}
}

#You are a member!
character_event = {
	id = SNB.6037
	picture = GFX_evt_society_joining
	desc = EVTDESC_SNB_6037
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6037

		join_society = the_shinobi 
		
		hidden_effect = {
			if = {
				limit = { event_target:shinobi_recruiter = { always = yes } }
				event_target:shinobi_recruiter = { set_character_flag = recruitment_success }
				event_target:grand_master = { character_event = { id = SNB.6040 } }
			}
		}
	}
}

#You flee
character_event = {
	id = SNB.6038
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { has_character_flag = escape_successful }
		text = EVTDESC_SNB_6038_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { has_character_flag = escape_injured }
		text = EVTDESC_SNB_6038_B
		picture = GFX_evt_bloody_man
	}
	desc = {
		trigger = { has_character_flag = escape_death }
		text = EVTDESC_SNB_6038_C
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { has_character_flag = escape_bribe }
		text = EVTDESC_SNB_6038_D
		picture = GFX_evt_whispers
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { event_target:shinobi_recruiter = { always = yes } }
			event_target:shinobi_recruiter = { set_character_flag = recruitment_fail }
			event_target:grand_master = { character_event = { id = SNB.6040 } } 
		}
		clr_character_flag = ongoing_recruitment
	}

	#Escape successfully
	option = {
		trigger = { has_character_flag = escape_successful }
		name = EVTOPTA_6038
		custom_tooltip = { text = EVTOPTA_6038_TOOLTIP }

		clr_character_flag = escape_successful
		
		if = { 
			limit = { event_target:shinobi_sacrifice = { NOT = { character = ROOT } } }
			add_friend = event_target:shinobi_sacrifice
		}
		
		hidden_effect = {
			random_list = {
				33 = {
					FROM = { add_trait = wounded }
					set_character_flag = shinobi_target_assaulted_member
				}
				33 = {
					FROM = { add_maimed_trait_effect = yes }
					set_character_flag = shinobi_target_assaulted_member
				}
				33 = {
					FROM = { death = { death_reason = death_murder_unknown killer = ROOT } }
					set_character_flag = shinobi_target_killed_member
				}
			}
		}
	}

	#Escaped but got injured
	option = {
		trigger = { has_character_flag = escape_injured }
		name = EVTOPTB_6038
		custom_tooltip = { text = EVTOPTA_6038_TOOLTIP }

		clr_character_flag = escape_injured

		add_maimed_trait_effect = yes

		if = {
			limit = { event_target:shinobi_sacrifice = { always = yes } }
			event_target:shinobi_sacrifice = { death = { death_reason = death_murder_unknown killer = FROM } }
		}

		hidden_effect = {
			random_list = {
				33 = {
					FROM = { add_trait = wounded }
					set_character_flag = shinobi_target_assaulted_member
				}
				33 = {
					FROM = { add_maimed_trait_effect = yes }
					set_character_flag = shinobi_target_assaulted_member
				}
				33 = {
					FROM = { death = { death_reason = death_murder_unknown killer = ROOT } }
					set_character_flag = shinobi_target_killed_member
				}
			}
		}
	}

	#Escaped but died
	option = {
		trigger = { has_character_flag = escape_death }
		name = EVTOPTC_6038

		death = { death_reason = death_murder_unknown killer = FROM }

		if = {
			limit = { event_target:shinobi_sacrifice = { always = yes } }
			event_target:shinobi_sacrifice = { death = { death_reason = death_murder_unknown killer = FROM } }
		}

	}

	#Bribe
	option = {
		trigger = { has_character_flag = escape_bribe }
		name = EVTOPTD_6038
		custom_tooltip = { text = EVTOPTA_6038_TOOLTIP }
		clr_character_flag = escape_bribe
	}
}

#Opt out failstate
character_event = {
	id = SNB.6039
	picture = GFX_evt_shadow
	desc = EVTDESC_SNB_6039
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6039
		hidden_effect = { clr_character_flag = ongoing_recruitment }
	}
}

#Ping event GM for outcome notification
character_event = {
	id = SNB.6040
	hide_window = yes

	is_triggered_only = yes

	immediate = { event_target:shinobi_recruiter = { letter_event = { id = SNB.6041 days = 5 } } }
}

#Outcome of recruitment for recruiter (if there is one)
letter_event = {
	id = SNB.6041
	border = GFX_event_letter_frame_religion

	desc = {
		trigger = { has_character_flag = recruitment_success }
		text = EVTDESC_SNB_6041_A
	}
	desc = {
		trigger = { has_character_flag = recruitment_fail }
		text = EVTDESC_SNB_6041_B
	}

	is_triggered_only = yes

	option = {
		trigger = { has_character_flag = recruitment_success }
		name = EXCELLENT

		clr_character_flag = recruitment_success
		add_society_currency_minor_effect = yes
	}

	option = {
		trigger = { has_character_flag = recruitment_fail }
		name = CURSES

		clr_character_flag = recruitment_fail
	}
}

###MURDER PLOT EVENTS (start on 6100)

#Plotter sees an opportunity - assassinate
character_event = {
	id = SNB.6100
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6100_A
		picture = GFX_evt_market_byzantine
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6100_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6100_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6100_D
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6100_E
		picture = GFX_evt_magnificent_castle
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6100_F
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6100_E
		picture = GFX_evt_magnificent_castle
	}
	
	is_part_of_plot = yes
	is_in_society = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		society_member_of = the_shinobi
		OR = {
			has_plot = plot_kill_character
			has_plot = plot_kill_spouse
		}
		plot_target_char = {
			is_murder_quest_target_of_root_trigger = yes
			OR = {
				at_location = ROOT
				ROOT = { is_inaccessible_trigger = no }
			}
		}
		NOT = { has_character_flag = murder_in_motion }
	}
	
	mean_time_to_happen = {
		months = 4000

		modifier = {
			society_rank = {
				society = the_shinobi
				rank == 3
			}
			factor = 0.3
		}
		modifier = {
			society_rank = {
				society = the_shinobi
				rank == 2
			}
			factor = 0.6
		}
		modifier = {
			plot_target_char = { is_inaccessible_trigger = yes }
			factor = 1.5
		}
		modifier = {
			plot_target_char = { prisoner = yes }
			factor = 1.5
		}
		modifier = {
			plot_power = 0.1
			factor = 0.6
		}
		modifier = {
			plot_power = 0.2
			factor = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.3
		}
		modifier = {
			factor = 0.6
			plot_power = 0.4
		}
		modifier = {
			factor = 0.6
			plot_power = 0.5
		}
		modifier = {
			factor = 0.6
			plot_power = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.7
		}
		modifier = {
			factor = 0.6
			plot_power = 0.8
		}
		modifier = {
			factor = 0.6
			plot_power = 0.9
		}
		modifier = {
			factor = 0.6
			plot_power = 1
		}
		modifier = {
			factor = 0.3
			plot_power = 1.5
		}
		modifier = {
			factor = 0.3
			plot_power = 2
		}
	}
	
	immediate = {
		plot_target_char = { save_event_target_as = plot_target }
		save_event_target_as = assassin_plot_owner

		#Set the assassination method
		event_target:plot_target = {
			if = {
				limit = {
					NOR = {
						prisoner = yes
						trait = in_hiding
						trait = incapable
						has_character_modifier = in_seclusion
					}
				}
				random_list = {
					40 = { set_character_flag = assassination_after_temple }
					30 = { set_character_flag = assassination_during_feast }
					30 = { set_character_flag = assassination_while_asleep }
				}
			}
			if = {
				limit = { prisoner = yes }
				set_character_flag = assassination_in_prison
			}
			if = {
				limit = { trait = in_hiding }
				set_character_flag = assassination_in_hiding
			}
			if = {
				limit = { has_character_modifier = in_seclusion }
				set_character_flag = assassination_in_seclusion
			}
			if = {
				limit = { trait = incapable }
				set_character_flag = assassination_incapable
			}
		}

		random_society_member = {
			limit = {
				society_rank = {
					rank == 4
					society = the_shinobi
				}
			}
			save_event_target_as = grand_master #for loc
		}
	}
	
	#Do it
	option = {
		name = EVTOPTA_SNB_6100
		custom_tooltip = { text = EVTOPTA_SNB_6100_TOOLTIP }
		hidden_effect = { 
			event_target:plot_target = { character_event = { id = SNB.6104 days = 7 } } 
			set_character_flag = murder_in_motion
		}
	}

	#Wait
	option = {
		name = EVTOPTB_SNB_6100
		custom_tooltip = { text = EVTOPTB_SNB_6100_TOOLTIP }
	}
}

#Plot backer sees an opportunity - assassinate
character_event = {
	id = SNB.6101
	picture = GFX_evt_market_byzantine
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6100_A
		picture = GFX_evt_market_byzantine
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6100_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6100_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6100_D
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6100_E
		picture = GFX_evt_magnificent_castle
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6100_F
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6100_E
		picture = GFX_evt_magnificent_castle
	}

	capable_only = yes
	prisoner = no
	is_part_of_plot = yes
	
	trigger = {
		any_backed_character = {
			plot_target_char = { is_murder_quest_target_of_root_trigger = yes }
			society_rank = {
				rank == 2
				society = the_shinobi
			}
			OR = {
				has_plot = plot_kill_character
				has_plot = plot_kill_spouse
			}
			NOT = { has_character_flag = murder_in_motion }	
		}
		NOT = { has_character_flag = murder_in_motion }
	}

	mean_time_to_happen = {
		months = 4000 

		modifier = {
			society_rank = {
				society = the_shinobi
				rank == 3
			}
			factor = 0.3
		}
		modifier = {
			society_rank = {
				society = the_shinobi
				rank == 2
			}
			factor = 0.6
		}

		modifier = {
			plot_target_char = { is_inaccessible_trigger = yes }
			factor = 1.5
		}
		modifier = {
			plot_target_char = { prisoner = yes }
			factor = 1.5
		}
		modifier = {
			plot_power = 0.1
			factor = 0.6
		}
		modifier = {
			plot_power = 0.2
			factor = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.3
		}
		modifier = {
			factor = 0.6
			plot_power = 0.4
		}
		modifier = {
			factor = 0.6
			plot_power = 0.5
		}
		modifier = {
			factor = 0.6
			plot_power = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.7
		}
		modifier = {
			factor = 0.6
			plot_power = 0.8
		}
		modifier = {
			factor = 0.6
			plot_power = 0.9
		}
		modifier = {
			factor = 0.6
			plot_power = 1
		}
		modifier = {
			factor = 0.3
			plot_power = 1.5
		}
		modifier = {
			factor = 0.3
			plot_power = 2
		}
	}

	immediate = {
		any_backed_character = {
			limit = {
				plot_target_char = { is_murder_quest_target_of_root_trigger = yes }
				society_member_of = the_shinobi
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
				NOT = { has_character_flag = murder_in_motion }	
			}
			save_event_target_as = assassin_plot_owner
			plot_target_char = { save_event_target_as = plot_target }
		}
		
		#Set the assassination method
		event_target:plot_target = {
			if = {
				limit = {
					NOR = {
						prisoner = yes
						trait = in_hiding
						trait = incapable
						has_character_modifier = in_seclusion
					}
				}
				random_list = {
					40 = { set_character_flag = assassination_after_temple }
					30 = { set_character_flag = assassination_during_feast }
					30 = { set_character_flag = assassination_while_asleep }
				}
			}
			if = {
				limit = { prisoner = yes }
				set_character_flag = assassination_in_prison
			}
			if = {
				limit = { trait = in_hiding }
				set_character_flag = assassination_in_hiding
			}
			if = {
				limit = { has_character_modifier = in_seclusion }
				set_character_flag = assassination_in_seclusion
			}
			if = {
				limit = { trait = incapable }
				set_character_flag = assassination_incapable
			}
		}

		random_society_member = {
			limit = {
				society_rank = {
					rank == 4
					society = the_shinobi
				}
			}
			save_event_target_as = grand_master #for loc
		}
	}

	#Do it
	option = {
		name = EVTOPTA_SNB_6101
		custom_tooltip = { text = EVTOPTA_SNB_6100_TOOLTIP }
		hidden_effect = { 
			set_character_flag = murder_in_motion
			event_target:plot_target = { character_event = { id = SNB.6104 days = 7 } }
			event_target:assassin_plot_owner = { letter_event = { id = SNB.6102 } }
		}
	}
}

#Plot owner recieves a letter informing them about the coming attempt
letter_event = {
	id = SNB.6102
	border = GFX_event_letter_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6102_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6102_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6102_C
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6102_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6102_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6102_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6102_D
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		custom_tooltip = { text = EVTOPTA_SNB_6102_TOOLTIP }
	}
}


#Assassination attempt
character_event = {
	id = SNB.6104
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6104_A
		picture = GFX_evt_market_byzantine
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6104_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6104_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6104_D
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6104_E
		picture = GFX_evt_magnificent_castle
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6104_F
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6104_C
		picture = GFX_evt_shadow
	}


	immediate = {
		FROM = { save_event_target_as = assassin } 
		random_courtier = {
			limit = {
				at_location = ROOT
				prisoner = no
				is_adult = yes
			}
			save_event_target_as = conversationalist
		}
		if = {
			limit = { NOT = { event_target:conversationalist = { always = yes } } }
			random_realm_character = {
				limit = { dynasty = none }
				save_event_target_as = conversationalist
			}
		}
	}

	option = {
		name = EVTOPTA_SNB_6104

		event_target:assassin_plot_owner = { clr_character_flag = murder_in_motion }

		hidden_effect = {
			random_list = {
				60  = { #Die
					random_list = {
						75 = {	#Not discovered
							modifier = {
								event_target:shinobi = { intrigue = 12 }
								factor = 1.5
							}
							modifier = {
								event_target:shinobi = { intrigue = 15 }
								factor = 1.5
							}
							character_event = { id = SNB.6105 days = 3 }
							tooltip = { add_trait = schemer }
						}
						25 = {	#Discovered
							modifier = {
								event_target:shinobi = { NOT = { intrigue = 8 } }
								factor = 1.5
							}
							modifier = {
								event_target:shinobi = { NOT = { intrigue = 5 } }
								factor = 1.5
							}
							character_event = { id = SNB.6108 days = 3 }
							event_target:assassin_plot_owner = { character_event = { id = 10 } }
							if = { 
								limit = { NOT = { event_target:shinobi = { character = event_target:assassin_plot_owner } } }
								event_target:shinobi = { character_event = { id = 10 } }
							}
							tooltip = { add_trait = deceitful }
						}
					}
					modifier = {
						event_target:shinobi = {
							society_rank = {
								society = the_shinobi
								rank == 2
							}
						}
						factor = 1.75
					}
					modifier = {
						event_target:shinobi = {
							society_rank = {
								society = the_shinobi
								rank == 3
							}
						}
						factor = 3
					}
					modifier = {
						event_target:shinobi = {
							society_rank = {
								society = the_shinobi
								rank == 4
							}
						}
						factor = 5
					}
					modifier = {
						factor = 3
						trait = incapable
					}
					modifier = {
						factor = 2
						prisoner = yes
					}
					modifier = {
						factor = 1.3
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
					}
					modifier = {
						factor = 1.3
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
					}
					modifier = {
						factor = 1.3
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
					}
					modifier = {
						factor = 1.3
						FROM = { combat_rating_diff = { character = ROOT value = 10 } }
					}
					modifier = {
						factor = 1.3
						FROM = { combat_rating_diff = { character = ROOT value = 20 } }
					}
					modifier = {
						factor = 1.3
						FROM = { combat_rating_diff = { character = ROOT value = 30 } }
					}
				}
				40 = { #Survive
					random_list = {
						50 = {	#Not discovered
							modifier = {
								event_target:shinobi = { intrigue = 12 }
								factor = 1.5
							}
							modifier = {
								event_target:shinobi = { intrigue = 15 }
								factor = 1.5
							}
							character_event = { id = SNB.6111 days = 3 }
						}
						25 = {	#Discovered and wounded
							modifier = {
								event_target:shinobi = { NOT = { intrigue = 8 } }
								factor = 1.5
							}
							modifier = {
								event_target:shinobi = { NOT = { intrigue = 5 } }
								factor = 1.5
							}
							character_event = { id = SNB.6114 days = 3 }
							event_target:assassin_plot_owner = { character_event = { id = 11 } }
							if = { 
								limit = { NOT = { event_target:shinobi = { character = event_target:assassin_plot_owner } } }
								event_target:shinobi = { character_event = { id = 11 } }
							}
						}
						25 = { #Killed assailant
							modifier = {
								factor = 1.3
								combat_rating_diff = { character = event_target:shinobi value = 10 }
							}
							modifier = {
								factor = 1.3
								combat_rating_diff = { character = event_target:shinobi value = 20 }
							}
							modifier = {
								factor = 1.3
								combat_rating_diff = { character = event_target:shinobi value = 30 }
							}
							character_event = { id = SNB.6117 days = 3 }
							event_target:assassin_plot_owner = { character_event = { id = 11 } }
							if = { 
								limit = { NOT = { event_target:shinobi = { character = event_target:assassin_plot_owner } } }
								event_target:shinobi = { character_event = { id = 11 } }
							}
						}
					}	
					modifier = {
						factor = 1.3
						attribute_diff = { character = event_target:shinobi attribute = intrigue value = 2 }
					}
					modifier = {
						factor = 1.3
						attribute_diff = { character = event_target:shinobi attribute = intrigue value = 4 }
					}
					modifier = {
						factor = 1.3
						attribute_diff = { character = event_target:shinobi attribute = intrigue value = 6 }
					}
					modifier = {
						factor = 1.3
						combat_rating_diff = { character = event_target:shinobi value = 10 }
					}
					modifier = {
						factor = 1.3
						combat_rating_diff = { character = event_target:shinobi value = 20 }
					}
					modifier = {
						factor = 1.3
						combat_rating_diff = { character = event_target:shinobi value = 30 }
					}
				}
			}
		}
	}
}

#Plot target dies, undiscovered
character_event = {
	id = SNB.6105
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6105_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6105_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6105_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6105_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6105_E
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6105_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6105_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_SNB_6105

		tooltip = { death = { death_reason = death_murder_unknown_hashashin killer = event_target:assassin_plot_owner } }



		hidden_effect = {
			event_target:shinobi = { character_event = { id = SNB.6106 } }
		}
	}
}

#Assassin notified of "Plot target dies, undiscovered"
character_event = {
	id = SNB.6106
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6106_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6106_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6106_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6106_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6106_E
		picture = GFX_evt_shadow
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6106_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6106_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6106
		FROM = { death = { death_reason = death_murder_unknown_hashashin killer = event_target:assassin_plot_owner } } 

		#If quest holder, clear quest and reward
		if = {
			limit = {
				has_quest = quest_the_shinobi_assassination
				quest_target = { character = event_target:plot_target }
			} 
			clr_quest = quest_the_shinobi_assassination
			sound_effect = shinobi_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}

		#If this is not your plot, give standard amount and notifiy plot holder
		if = {
			limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
			hidden_effect = { event_target:assassin_plot_owner = { letter_event = { id = SNB.6107 } } }
			add_society_currency_minor_effect = yes
		}

		if = {
			limit = { event_target:plot_target = { has_character_flag = shinobi_target_marked_for_death }	}

			random_society_member = { 
				limit = { society_rank = { rank == 4 society = the_shinobi } }
				letter_event = { id = SNB.6843 }
			}
		}

		hidden_effect = {
			event_target:plot_target = { character_event = { id = SNB.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target dies, undiscovered"
letter_event = {
	id = SNB.6107
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_SNB_6107

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		clr_character_flag = murder_in_motion

		
		if = {
			limit = {
				has_quest = quest_the_shinobi_assassination
				quest_target = { character = event_target:plot_target }
			}
			clr_quest = quest_the_shinobi_assassination
			sound_effect = shinobi_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}
	}
}

#Plot target dies, discovered
character_event = {
	id = SNB.6108
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6108_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6108_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6108_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6108_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6108_E
		picture = GFX_evt_shadow
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6108_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6108_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_SNB_6105

		tooltip = { death = { death_reason = death_murder_hashashin killer = event_target:assassin_plot_owner } }

		hidden_effect = {
			event_target:assassin = { character_event = { id = SNB.6109 } }
		}
	}
}

#Assassin notified of "Plot target dies, discovered"
character_event = {
	id = SNB.6109
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6109_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6109_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6109_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6109_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6109_E
		picture = GFX_evt_shadow
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6109_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6109_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6109
		custom_tooltip = { text = EVTOPTA_SNB_6109_TOOLTIP }
		
		FROM = { death = { death_reason = death_murder_hashashin killer = event_target:assassin } }

		#If quest holder, clear quest and reward
		if = {
			limit = {
				has_quest = quest_the_shinobi_assassination
				quest_target = { character = event_target:plot_target }
			}
			clr_quest = quest_the_shinobi_assassination
			sound_effect = shinobi_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}

		#If this is not your plot, give standard amount and notifiy plot holder
		if = {
			limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:shinobi } } }
			hidden_effect = { event_target:assassin_plot_owner = { letter_event = { id = SNB.6110 } } }
			add_society_currency_minor_effect = yes
		}

		if = {
			limit = { event_target:plot_target = { has_character_flag = shinobi_target_marked_for_death }	}
			random_society_member = { 
				limit = { society_rank = { rank == 4 society = the_shinobi } }
				letter_event = { id = SNB.6843 }
			}
		}

		hidden_effect = {
			event_target:plot_target = { character_event = { id = SNB.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target dies, discovered"
letter_event = {
	id = SNB.6110
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_SNB_6110

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6110
		custom_tooltip = { text = EVTOPTA_SNB_6110_TOOLTIP }
		clr_character_flag = murder_in_motion

		#If quest holder, clear quest and reward
		if = {
			limit = {
				has_quest = quest_the_shinobi_assassination
				quest_target = { character = event_target:plot_target }
			}
			clr_quest = quest_the_shinobi_assassination
			sound_effect = shinobi_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}
	}
}

#Plot target survives, undiscovered
character_event = {
	id = SNB.6111
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6111_A
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6111_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6111_C
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6111_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6111_E
		picture = GFX_evt_melee
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6111_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6111_C
		picture = GFX_evt_melee
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_SNB_6111
		custom_tooltip = { text = EVTOPTA_SNB_6111_TOOLTIP }

		hidden_effect = {
			event_target:shinobi = { character_event = { id = SNB.6112 } }
		}
	}
}

#Assassin notified of "Plot target survives, undiscovered"
character_event = {
	id = SNB.6112
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6112_A
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6112_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6112_C
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6112_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6112_E
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6112_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6112_C
		picture = GFX_evt_melee
	}


	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6112
		custom_tooltip = { text = EVTOPTA_SNB_6112_TOOLTIP }

		hidden_effect = {
			if = {
				limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:shinobi } } }
				event_target:assassin_plot_owner = { letter_event = { id = SNB.6113 } }
			}
			event_target:plot_target = { character_event = { id = SNB.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target survives, undiscovered"
letter_event = {
	id = SNB.6113
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_SNB_6113

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6113
		custom_tooltip = { text = EVTOPTA_SNB_6113_TOOLTIP }
		clr_character_flag = murder_in_motion
	}
}

#Plot target survives, wounded
character_event = {
	id = SNB.6114
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6114_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6114_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6114_B
	}


	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6114
		custom_tooltip = { text = EVTOPTA_SNB_6111_TOOLTIP }

		random_list = {
			70 = {
				event_target:shinobi = { 
					tooltip = { add_trait = wounded }
					set_character_flag = assassin_wounded
				}
			}
			30 = {
				event_target:shinobi = {
					tooltip = { add_maimed_trait_effect = yes }
					set_character_flag = assassin_maimed
				}
			}
		}

		hidden_effect = {
			event_target:shinobi = { character_event = { id = SNB.6115 } }
		}
	}
}

#Assassin notified of "Plot target survives, wounded"
character_event = {
	id = SNB.6115
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6115_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6115_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6115_C
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6115_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6115_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6115_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6115_C
	}


	is_triggered_only = yes

	option = {
		name = CURSES
		custom_tooltip = { text = EVTOPTA_SNB_6109_TOOLTIP }

		if = {
			limit = { has_character_flag = assassin_wounded }
			add_trait_wounded_effect = yes
			clr_character_flag = assassin_wounded
		}
		if = {
			limit = { has_character_flag = assassin_maimed }
			add_maimed_trait_effect = yes
			clr_character_flag = assassin_maimed
		}

		hidden_effect = {
			if = {
				limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:shinobi } } }
				event_target:assassin_plot_owner = { letter_event = { id = SNB.6116 } }
			}
			event_target:plot_target = { character_event = { id = SNB.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target survives, wounded"
letter_event = {
	id = SNB.6116
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_SNB_6116

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6116
		custom_tooltip = { text = EVTOPTA_SNB_6116_TOOLTIP }
		clr_character_flag = murder_in_motion
	}
}

#Plot target survives, killed
character_event = {
	id = SNB.6117
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6117_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6117_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6117_B
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6117
		custom_tooltip = { text = EVTOPTA_SNB_6111_TOOLTIP }

		tooltip = { event_target:shinobi = { death = { death_reason = death_battle killer = event_target:plot_target } } }

		hidden_effect = {
			event_target:shinobi = { character_event = { id = SNB.6118 } }
		}
	}
}

#Assassin notified of "Plot target survives, killed"
character_event = {
	id = SNB.6118
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_SNB_6118_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_SNB_6118_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_SNB_6118_C
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_SNB_6118_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_SNB_6118_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_SNB_6118_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_SNB_6118_C
	}


	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6105

		hidden_effect = {
			if = {
				limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
				event_target:assassin_plot_owner = { character_event = { id = SNB.6119 } }
			}
			clr_character_flag = murder_in_motion
			event_target:plot_target = { character_event = { id = SNB.6120 days = 1 } } #Clears flags
		}
		death = { death_reason = death_battle killer = event_target:plot_target } 
	}
}

#Plot owner notified "Plot target survives, killed"
character_event = {
	id = SNB.6119
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_SNB_6119
	picture = GFX_evt_melee

	is_triggered_only = yes

	option = {
		name = CURSES
		clr_character_flag = murder_in_motion
	}
}

#Clean-up for target
character_event = {
	id = SNB.6120
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		clr_character_flag = assassination_after_temple
		clr_character_flag = assassination_in_prison
		clr_character_flag = assassination_in_hiding
		clr_character_flag = assassination_in_seclusion
		clr_character_flag = assassination_incapable
		clr_character_flag = assassination_during_feast
		clr_character_flag = assassination_while_asleep
	}
}

###MISSIONS### (start on 6199)

#Mission tombola
character_event = {
	id = SNB.6199
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		society_member_of = the_shinobi
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		is_society_grandmaster = no
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				society_member_of = the_shinobi
			}
			save_event_target_as = grand_master
		}

		random_list = {
			15 = { 
				#modifier = {
				#	factor = 10
				#	ai = yes
				#}
				character_event = { id = SNB.6200 } #Assassination 
			}
			20 = {
				modifier = { factor = 0 ai = yes }
				modifier = { factor = 0 NOT = { religion = nihon_shinto } }
				event_target:grand_master = { character_event = { id = SNB.6203 } } #Convert a specific holding
			}
			15 = {
				modifier = {
					factor = 0
					NOT = { 
						any_character = {
							is_offmap_ruler = no
							is_within_diplo_range = ROOT
							is_adult = yes
							has_character_flag = shinobi_refused_to_pay_debt
							OR = {
								has_character_modifier = borrowed_from_shinobi
								has_character_modifier = shinobi_debt
							}
						}
					}
				}
				event_target:grand_master = { character_event = { id = SNB.6214 } } # Collect debt
			}
			10 = {
				modifier = { 
					factor = 0 
					is_playable = no 
				}
				modifier = {
					factor = 0
					NOT = { religion = nihon_shinto }
				}
				modifier = {
					factor = 0
					independent = no
				}
				modifier = { 
					factor = 0
					ai = yes
				}
				modifier = {
					factor = 0
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								owner = {
									top_liege = {
										NOT = { character = ROOT }
										NOT = { religion = nihon_shinto }
										any_realm_province = {
											owner = { NOT = { religion = nihon_shinto } }
											any_province_holding = { 
												owner = { NOT = { religion = nihon_shinto } } 
												OR = {
													holding_type = temple
													holding_type = castle
												}
											}
										}
									}
								}
							}
						}
					}
				}
				event_target:grand_master = { character_event = { id = SNB.6220 } } #Occupy infidel holding
			}
			5 = {
				event_target:grand_master = { character_event = { id = SNB.6248 } } #Train protege
			}
			50 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
						if = { # Added to promote landless shinobi to rank 2, so they can participate in plots
							limit = {
								society_rank < 2
								society_can_rank_up = yes
							}
							random_list = {
								50 = {}
								50 = {
									society_rank_up = 1					
								}
							}
						}
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			125 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}

#MISSION: Assassinate a target 
character_event = {
	id = SNB.6200
	hide_window = yes

	is_triggered_only = yes

	immediate = { 
		random_list = {
			40 = { #Infidel ruler at war with shia, or their vassal/commander
				trigger = {
					any_independent_ruler = { 
						is_within_diplo_range = ROOT #Not using shinobi_appropriate_target_trigger here to also find vassals/commanders
						NOT = { character = ROOT }
						NOT = { religion = nihon_shinto }
						NOT = { society_member_of = the_shinobi }
						any_war = {
							attacker = { character = PREV }
							defender = { 
								religion = nihon_shinto 
								NOT = { character = ROOT }
							}
						}
					}
				}

				#Find the ruler
				random_independent_ruler = {
					limit = {
						is_within_diplo_range = ROOT #Not using shinobi_appropriate_target_trigger here to also find vassals/commanders
						NOT = { character = ROOT }
						NOT = { religion = nihon_shinto }
						NOT = { society_member_of = the_shinobi }
						any_war = {
							any_attacker = { character = PREV }
							defender = { 
								religion = nihon_shinto 
								NOT = { character = ROOT }
							}
						}
					}

					if = {
						limit = {
							shinobi_appropriate_target_trigger = yes
						}
						save_event_target_as = shinobi_target
					}

					else =  {

						save_event_target_as = shinobi_aggressor
						
						random_vassal = {
							limit = { 
								shinobi_appropriate_target_trigger = yes
								NOT = { character = ROOT }
								NOT = { society_member_of = the_shinobi }
								OR = {
									liege = { is_feudal = yes }
									any_war = {
										any_attacker = { character = PREV }
										defender = { religion = nihon_shinto }
									}
								}
							}
							save_event_target_as = shinobi_target
						}

						random_courtier_or_vassal = {
							limit = {
								shinobi_appropriate_target_trigger = yes
								NOT = { society_member_of = the_shinobi }
								in_command = yes
								OR = {
									is_ruler = no
									OR = {
										liege = { is_feudal = yes }
										any_war = {
											any_attacker = { character = PREV }
											defender = { religion = nihon_shinto }
										}
									}
								}
							}
							save_event_target_as = shinobi_target
						}

						event_target:shinobi_target = {
							if = {
								limit = { independent = yes }
								set_character_flag = shinobi_target_war_attacker
							}
							if = {
								limit = {
									independent = no
									in_command = no
								}
								set_character_flag = shinobi_target_war_attacker_vassal
							}
							if = {
								limit = {
									independent = no
									in_command = yes
								}
								set_character_flag = shinobi_target_war_attacker_commander
							}
						}
					}
				}
			}
			15 = { #Assaulted an assassin
				trigger = {
					any_character = {
						is_offmap_ruler = no 
						NOT = { character = ROOT }
						shinobi_appropriate_target_trigger = yes
						has_character_flag = shinobi_target_assaulted_member
					}
				}
				random_character = {
					limit = { 
						is_offmap_ruler = no
						NOT = { character = ROOT }
						shinobi_appropriate_target_trigger = yes
						has_character_flag = shinobi_target_assaulted_member 
					}
					save_event_target_as = shinobi_target
				}
			}
			20 = { #Killed an assassin
				trigger = {
					any_character = {
						is_offmap_ruler = no 
						NOT = { character = ROOT }
						shinobi_appropriate_target_trigger = yes
						has_character_flag = shinobi_target_killed_member
					}
				}
				random_character = {
					limit = { 
						is_offmap_ruler = no
						NOT = { character = ROOT }
						shinobi_appropriate_target_trigger = yes
						has_character_flag = shinobi_target_killed_member 
					}
					save_event_target_as = shinobi_target
				}
			}
			20 = { #Marked for death by GM
				trigger = {
					any_character = {
						is_offmap_ruler = no 
						NOT = { character = ROOT }
						shinobi_appropriate_target_trigger = yes
						has_character_flag = shinobi_target_marked_for_death
					}
				}
				random_character = {
					limit = { 
						is_offmap_ruler = no
						NOT = { character = ROOT }
						shinobi_appropriate_target_trigger = yes
						has_character_flag = shinobi_target_marked_for_death 
					}
					save_event_target_as = shinobi_target
				}
			} 
			15 = { #Cruel non-shia ruler with shia population
				trigger = {
					any_independent_ruler = {
						shinobi_appropriate_target_trigger = yes
						NOT = { character = ROOT }
						NOT = { society_member_of = the_shinobi }
						OR = {
							is_evil_trigger = yes
							trait = zealous
						}
						NOT = { religion = nihon_shinto }
						any_realm_province = { religion = nihon_shinto }
					}
				}
				random_independent_ruler = {
					limit = {
						shinobi_appropriate_target_trigger = yes
						NOT = { character = ROOT }
						NOT = { society_member_of = the_shinobi }
						OR = {
							is_evil_trigger = yes
							trait = zealous
						}
						NOT = { religion = nihon_shinto }
						any_realm_province = { religion = nihon_shinto }
					}
					save_event_target_as = shinobi_target
					set_character_flag = shinobi_target_persecutes_shiites
				}
			}
		}

		if = { #Fallback
			limit = { NOT = { event_target:shinobi_target = { always = yes } } }
			random_playable_ruler = {
				limit = {
					shinobi_appropriate_target_trigger = yes
					NOT = { character = ROOT }
					NOT = { religion = nihon_shinto }
					NOT = { society_member_of = the_shinobi }
					OR = {
						NOT = {
							any_playable_ruler = {
								shinobi_appropriate_target_trigger = yes
								NOT = { religion = nihon_shinto }
								NOT = { society_member_of = the_shinobi }
								
								OR = {
									is_evil_trigger = yes
									trait = zealous
								}
							}
						}
						OR = {
							is_evil_trigger = yes
							trait = zealous
						}
					}
				}
				save_event_target_as = shinobi_target
				set_character_flag = shinobi_target_fallback
			}
		}

		if = {
			limit = { 
				event_target:shinobi_target = { always = yes } 
				is_within_diplo_range = event_target:shinobi_target
			}
			random_society_member = {
				limit = { society_rank = { rank == 4 society = the_shinobi } }
				character_event = { id = SNB.6201 }
			}
		}
		if = {
			limit = { NOT = { is_within_diplo_range = event_target:shinobi_target } }
			event_target:shinobi_target = {
				clr_character_flag = shinobi_target_persecutes_shiites
				clr_character_flag = shinobi_target_fallback
				clr_character_flag = shinobi_target_war_attacker
				clr_character_flag = shinobi_target_war_attacker_vassal
				clr_character_flag = shinobi_target_war_attacker_commander
			}
		}
	}
}

#Ping event for GM
character_event = {
	id = SNB.6201
	hide_window = yes

	is_triggered_only = yes

	immediate = { 
		if = {
			limit = { event_target:shinobi_target = { always = yes } }
			FROM = { society_quest_event = { id = SNB.6202 days = 7 random = 7 } } 
		}
	}
}

#You get your target
society_quest_event = {
	id = SNB.6202
	title = quest_the_shinobi_assassination
	quest_target = event_target:shinobi_target
	
	trigger = {
		is_in_society = yes
		event_target:shinobi_target = {
			is_alive = yes
		}
	}

	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_war_attacker } }
		text = EVTDESC_SNB_6202_WAR_ATTACKER
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_war_attacker_vassal } }
		text = EVTDESC_SNB_6202_WAR_ATTACKER_VASSAL
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_war_attacker_commander } }
		text = EVTDESC_SNB_6202_WAR_ATTACKER_COMMANDER
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_assaulted_member } }
		text = EVTDESC_SNB_6202_ASSAULTED_MEMBER
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_killed_member } }
		text = EVTDESC_SNB_6202_KILLED_MEMBER
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_marked_for_death } }
		text = EVTDESC_SNB_6202_MARKED_FOR_DEATH
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_persecutes_shiites } }
		text = EVTDESC_SNB_6202_PERSECUTED_SHIITES
	}
	desc = {
		trigger = { event_target:shinobi_target = { has_character_flag = shinobi_target_fallback } }
		text = EVTDESC_SNB_6202_FALLBACK
	}

	is_triggered_only = yes

	immediate = { #For loc
		hidden_effect = {
			event_target:shinobi_target = {
				any_war = {
					limit = { defender = { religion = nihon_shinto } }
					defender = { save_event_target_as = shiite_defender }
				}
				any_realm_province = {
					limit = { religion = nihon_shinto }
					save_event_target_as = shiite_province
				}
			}
		}
	}

	option = {
		name = ACCEPT
		
		event_target:shinobi_target = {
			set_quest_target = {
				id = quest_the_shinobi_assassination
				holder = ROOT
			}
		}

		hidden_effect = {
			if = { #Makes sure the AI actually does the mission
				limit = { ai = yes }
				random_list = {
					20 = {
						trigger = { 
							attribute_diff = { character = event_target:shinobi_target attribute = intrigue value = 6 } 
							society_rank = 2
						}
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = SNB.6948 days = 150 random = 100 } #Triggers plot event 
					}
					20 = {
						trigger = { attribute_diff = { character = event_target:shinobi_target attribute = intrigue value = 3 } }
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = SNB.6948 days = 300 random = 100 } #Triggers plot event
					}
					20 = {
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = SNB.6948 days = 500 random = 300 } #Triggers plot event
					}
					40 = {
						modifier = { event_target:shinobi_target = { intrigue = 12 } factor = 1.2 }
						modifier = { event_target:shinobi_target = { intrigue = 14 } factor = 1.2 }
						modifier = { event_target:shinobi_target = { intrigue = 16 } factor = 1.2 }
						modifier = { event_target:shinobi_target = { intrigue = 18 } factor = 1.2 }
						modifier = { event_target:shinobi_target = { tier = COUNT } factor = 1.5 }
						modifier = { event_target:shinobi_target = { tier = DUKE } factor = 2 }
						modifier = { event_target:shinobi_target = { tier = KING } factor = 2.5 }
						modifier = { event_target:shinobi_target = { tier = EMPEROR } factor = 5 }
						character_event = { id = SNB.6949 } #Clears quest
					}
				}
			}
		}
		event_target:shinobi_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option

			hidden_effect = {
				clr_character_flag = shinobi_target_persecutes_shiites
				clr_character_flag = shinobi_target_fallback
				clr_character_flag = shinobi_target_war_attacker
				clr_character_flag = shinobi_target_war_attacker_vassal
				clr_character_flag = shinobi_target_war_attacker_commander
			}
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			event_target:shinobi_target = {
				clr_character_flag = shinobi_target_persecutes_shiites
				clr_character_flag = shinobi_target_fallback
				clr_character_flag = shinobi_target_war_attacker
				clr_character_flag = shinobi_target_war_attacker_vassal
				clr_character_flag = shinobi_target_war_attacker_commander
			}

			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}

		ai_chance = { factor = 0 }
	}
}

#Helps AI do mission
character_event = {
    id = SNB.6948
    hide_window = yes
    is_triggered_only = yes
    trigger = { 
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } } 
    	has_quest = quest_the_shinobi_assassination
    }
    immediate = {
    	character_event = { id = SNB.6100 }
    }
}

#AI clean-up
character_event = {
    id = SNB.6949
    hide_window = yes
    is_triggered_only = yes
    trigger = { 
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } } 
    	has_quest = quest_the_shinobi_assassination
    }
    immediate = {
    	clr_quest = {
    		id = quest_the_shinobi_assassination
    		failure = yes
    	}
    }
}

character_event = {
    id = SNB.6950
    desc = EVTDESC_SNB_6950
    picture = GFX_evt_assassination
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes
    
    trigger = {
    	has_quest = quest_the_shinobi_assassination
    }

    option = { 
        name = EVTOPTA_SNB_6106
        clr_quest = quest_the_shinobi_assassination
        sound_effect = shinobi_assassinate_character

		if = {
			limit = { event_target:plot_target = { higher_tier_than = DUKE } }
			add_society_currency_medium_effect = yes
		}
		if = {
			limit = { event_target:plot_target = { lower_tier_than = KING } }
			add_society_currency_minor_effect = yes
		}
    }
}

###POWERS###

#POWER: Drugs
character_event = {
	id = SNB.6800
	desc = EVTDESC_SNB_6800
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	immediate = {
		set_character_flag = shinobi_taking_drugs #Is removed in 6802
	}

	is_triggered_only = yes

	#Small dose
	option = {
		name = EVTOPTA_SNB_6800
		custom_tooltip = { text = EVTOPTA_SNB_6800_TOOLTIP }

		set_character_flag = drugs_small_dose

		hidden_effect = { character_event = { id = SNB.6801 } }
	}

	#Regular dose
	option = {
		name = EVTOPTB_SNB_6800
		custom_tooltip = { text = EVTOPTB_SNB_6800_TOOLTIP }

		hidden_effect = { character_event = { id = SNB.6801 } }
	}

	#Big dose
	option = {
		name = EVTOPTC_SNB_6800
		custom_tooltip = { text = EVTOPTC_SNB_6800_TOOLTIP }

		set_character_flag = drugs_big_dose

		hidden_effect = { character_event = { id = SNB.6801 } }
	}
}

#Drug tombola!
character_event = {
	id = SNB.6801
	hide_window = yes

	is_triggered_only = yes

	immediate = {	
		#How will the trip be, over all?
		random_list = {
			20 = { #Great
				set_character_flag = great_trip

				modifier = {
					has_character_flag = drugs_big_dose
					factor = 2
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					trait = hedonist
					factor = 1.5
				}
			}
			60 = { #Good
				set_character_flag = good_trip
			}
			20 = { #Bad
				set_character_flag = bad_trip

				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_mental_disorder_trigger = yes
					factor = 1.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = paranoid
					factor = 1.5
				}
			}
		}

		#Outcome
		character_event = { id = SNB.6802 days = 7 } #Overall outcome

		#Special events, all with 4 day delays, weight with trip flags
		random_list = {
			10 = { #Nothing
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 2
				}
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 0.5
				}
			}
			10 = { #Become posessed
				modifier = {
					NOT = { has_character_flag = bad_trip}
					factor = 0
				}
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}

				if = {
					limit = {
						NOT = { trait = possessed}
					}
					set_character_flag = become_possessed
					character_event = { id = SNB.6810 days = 4}
				}
			}
			10 = { #Become paranoid
				modifier = {
					NOT = { has_character_flag = bad_trip}
					factor = 0
				}
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = trusting
					factor = 0.5
				}
				if = {
					limit = {
						NOT = { trait = paranoid}
					}
					set_character_flag = become_paranoid
					character_event = { id = SNB.6810 days = 4}
				}
			}
			5 = { 	#Become gluttonous
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = temperate
					factor = 0.5
				}
				if = {
					limit = {
						NOT = { trait = gluttonous }
					}
					set_character_flag = become_gluttonous
					character_event = { id = SNB.6810 days = 4}
				}
			}
			5 = { 	#Become slothful
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = diligent
					factor = 0.5
				}
				if = {
					limit = {
						NOT = { trait = slothful }
					}
					set_character_flag = become_slothful
					character_event = { id = SNB.6810 days = 4}
				}
			}
			10 = { #Discover a plot
				modifier = {
					NOT = {has_character_flag = good_trip}
					factor = 2
				}
				modifier = {
					trait = paranoid
					factor = 2
				}
				modifier = {
					trait = possessed
					factor = 1.5
				}
				modifier = {
					NOT = {
						top_liege = {
							any_realm_character = {
								has_plot = yes
								NOT = {
									plot_is_known_by = ROOT
								}
							}
						}
					}
					factor = 0
				}
				character_event = { id = SNB.6811}
			} 
			10 = { #Gain a lover, perhaps your spouse?
				modifier = {
					has_character_flag = great_trip
					factor = 2
				}
				modifier = {
					has_character_flag = bad_trip
					factor = 0
				}
				modifier = {
					trait = lustful
					factor = 1.5
				}
				modifier = {
					trait = eunuch
					factor = 0
				}
				modifier = {
					has_lover = yes
					factor = 0.5
				}
				set_character_flag = drug_lover
				character_event = { id = SNB.6812 days = 4}
			}
			20 = { #Gain a friend
				modifier = {
					has_character_flag = great_trip
					factor = 2
				}
				modifier = {
					has_character_flag = bad_trip
					factor = 0
				}
				modifier = {
					trait = paranoid
					factor = 0.5
				}
				set_character_flag = drug_friend
				character_event = { id = SNB.6812 days = 4}
			}
			10 = { #Discover a cheating spouse
				modifier = {
					is_married = no
					factor = 0
				}
				modifier = {
					NOR = {
						any_spouse = {
							any_lover = {
								NOT = {
									character = ROOT
								}
							}
						}
						AND = {
							trait = paranoid
							any_realm_character = {
		 						same_sex = root
		 						NOT = { character = ROOT }
							}
						}
					}
					factor = 0
				}
				character_event = { id = SNB.6813 days = 4}
			}
			10 = { #Make a fool of yourself
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				character_event = { id = SNB.6814 days = 4}
			}
			10 = { #Die, only if you're already an addict
				modifier = {
					NOT = { has_character_flag = drugs_big_dose}
					factor = 0.5
				}
				modifier = {
					NOT = { has_character_flag = bad_trip}
					factor = 0
				}
				modifier = {
					NOT = { has_character_modifier = hashish_addict }
					factor = 0
				}
				modifier = {
					has_character_modifier = withdrawal_symptoms
					factor = 1.5
				}
				modifier = {
					has_character_modifier = drugs_timer
					factor = 2
				}
				modifier = {
					trait = gluttonous 
					factor = 1.5
				}
				modifier = {
					trait = temperate 
					factor = 0.5
				}
				modifier = {
					health = 5
					factor = 0
				}
				modifier = {
					OR = {
						trait = ill
						trait = pneumonic
						trait = has_tuberculosis
						trait = cough
						trait = chest_pain
					}
					factor = 2
				}
				character_event = { id = SNB.6815 days = 4}
			}
			10 = { # Cure stressed
				modifier = {
					factor = 0
					NOT = { trait = stressed }
				}
				modifier = {
					factor = 0.5
					has_character_flag = drugs_small_dose
				}
				set_character_flag = drugs_curing_stressed
				character_event = { id = SNB.6816 days = 4 }
			}
			10 = { # Cure possessed
				modifier = {
					factor = 0
					NOT = { trait = possessed }
				}
				modifier = {
					factor = 0.5
					has_character_flag = drugs_small_dose
				}
				set_character_flag = drugs_curing_possessed
				character_event = { id = SNB.6816 days = 4 }
			}
			10 = { # Cure depressed
				modifier = {
					factor = 0
					NOT = { trait = depressed }
				}
				modifier = {
					factor = 0.5
					NOT = { has_character_flag = drugs_big_dose }
				}
				set_character_flag = drugs_curing_depressed
				character_event = { id = SNB.6816 days = 4 }
			}
			10 = { # Cure lunatic
				modifier = {
					factor = 0
					NOT = { trait = lunatic }
				}
				modifier = {
					factor = 0
					NOT = { has_character_flag = drugs_big_dose }
				}
				set_character_flag = drugs_curing_lunatic
				character_event = { id = SNB.6816 days = 4 }
			}
			10 = { # Diplomatic insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = diplomatic_insight
				}
				set_character_flag = gains_diplomatic_insight_flag
				character_event = { id = SNB.6817 days = 4 }
			}
			10 = { # Martial insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = martial_insight
				}
				set_character_flag = gains_martial_insight_flag
				character_event = { id = SNB.6817 days = 4 }
			}
			10 = { # Intrigue insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = intrigue_insight
				}
				set_character_flag = gains_intrigue_insight_flag
				character_event = { id = SNB.6817 days = 4 }
			}
			10 = { # Learning insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = learning_insight
				}
				set_character_flag = gains_learning_insight_flag
				character_event = { id = SNB.6817 days = 4 }
			}
			10 = { # Stewardship insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = stewardship_insight
				}
				set_character_flag = gains_stewardship_insight_flag
				character_event = { id = SNB.6817 days = 4 }
			}
			10 = { #Cure your disease
				modifier = {
					factor = 0
					NOT = { has_dlc = "Reapers" }
				}
				modifier = {
					factor = 0
					has_disease_trigger = no
				}
				modifier = {
					factor = 3
					has_character_flag = great_trip
				}
				character_event = { id = SNB.6818 days = 4 }
			}
		}
		random = {
			chance = 5

			character_event = { id = SNB.6803 days = 20 random = 20 } #Gives addiction

			modifier = {
				has_character_modifier = hashish_addict
				factor = 0
			}
			modifier = {
				has_character_modifier = drugs_timer
				factor = 4
			}
			modifier = {
				has_character_flag = drugs_big_dose
				factor = 1.5
			}
			modifier = {
				has_character_flag = drugs_small_dose
				factor = 0.5
			}
			modifier = {
				trait = gluttonous 
				factor = 1.5
			}
			modifier = {
				trait = temperate 
				factor = 0.5
			}
			modifier = {
				has_mental_disorder_trigger = yes
				factor = 2
			}
		}

		#Add drug timer based on dosage
		if = {
			limit = { has_character_flag = drugs_small_dose }
			add_character_modifier = {
				name = drugs_timer
				hidden = yes
				days = 365
			}
		}
		if = {
			limit = { 
				NOR = {
					has_character_flag = drugs_small_dose 
					has_character_flag = drugs_big_dose
				}
			}
			add_character_modifier = {
				name = drugs_timer
				hidden = yes
				days = 600
			}
		}
		if = {
			limit = { has_character_flag = drugs_big_dose }
			add_character_modifier = {
				name = drugs_timer
				hidden = yes
				days = 900
			}
		}	

		#Illness handling
		random = {
			chance = 5
			give_cancer_effect = yes
		}

		#Removing flags
		clr_character_flag = drugs_small_dose
		clr_character_flag = drugs_big_dose
	}
}

#Outcome of trip
character_event = {
	id = SNB.6802
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		trigger = { has_character_flag = great_trip }
		text = EVTDESC_SNB_6802_GREAT
		picture = GFX_evt_religious_exultation
	}
	desc = {
		trigger = { has_character_flag = good_trip }
		text = EVTDESC_SNB_6802_GOOD
		picture = GFX_evt_dark_prayer
	}
	desc = {
		trigger = { has_character_flag = bad_trip }
		text = EVTDESC_SNB_6802_BAD
		picture = GFX_evt_impalement
	}

	is_triggered_only = yes
	
	option = {
		name = {
			trigger = { has_character_flag = great_trip }
			text = EVTOPTA_SNB_6802_GREAT
		}
		name = {
			trigger = { has_character_flag = good_trip }
			text = EVTOPTA_SNB_6802_GOOD
		}
		name = {
			trigger = { has_character_flag = bad_trip }
			text = EVTOPTA_SNB_6802_BAD
		}

		if = {
			limit = { has_character_flag = great_trip }
			if = {
				limit = { has_character_modifier = astounding_visions }
				remove_character_modifier = astounding_visions
			}
			if = {
				limit = { has_character_modifier = uplifting_visions }
				remove_character_modifier = uplifting_visions
			}
			if = {
				limit = { has_character_modifier = frightening_visions }
				remove_character_modifier = frightening_visions
			}
			add_character_modifier = {
				name = astounding_visions
				days = 365
			}
			clr_character_flag = great_trip
		}
		if = {
			limit = { has_character_flag = good_trip }
			if = {
				limit = { has_character_modifier = astounding_visions }
				remove_character_modifier = astounding_visions
			}
			if = {
				limit = { has_character_modifier = uplifting_visions }
				remove_character_modifier = uplifting_visions
			}
			if = {
				limit = { has_character_modifier = frightening_visions }
				remove_character_modifier = frightening_visions
			}
			add_character_modifier = {
				name = uplifting_visions
				days = 365
			}
			clr_character_flag = good_trip
		}

		if = {
			limit = { has_character_flag = bad_trip }
			if = {
				limit = { has_character_modifier = astounding_visions }
				remove_character_modifier = astounding_visions
			}
			if = {
				limit = { has_character_modifier = uplifting_visions }
				remove_character_modifier = uplifting_visions
			}
			if = {
				limit = { has_character_modifier = frightening_visions }
				remove_character_modifier = frightening_visions
			}
			add_character_modifier = {
				name = frightening_visions
				days = 365
			}
			clr_character_flag = bad_trip
		}
		clr_character_flag = shinobi_taking_drugs
	}
}

#You're an addict
character_event = {
	id = SNB.6803
	desc = EVTDESC_SNB_6803
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion

	trigger = { NOT = { has_character_modifier = hashish_addict } }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6803
		custom_tooltip = { text = EVTOPTA_6803_TOOLTIP }

		add_character_modifier = {
			name = hashish_addict
			duration = -1
		}

		hidden_effect = { character_event = { id = SNB.6804 days = 100 } } 
	}
}

#Hidden addiction handling
character_event = {
	id = SNB.6804
	hide_window = yes

	trigger = { has_character_modifier = hashish_addict }

	is_triggered_only = yes

	immediate = {
		#Withdrawal syptoms
		random = {
			chance = 20
			character_event = { id = SNB.6805 }
		}
		#Recover
		if = {
			limit = { has_character_modifier =  withdrawal_symptoms }
			random = {
				chance = 40
				character_event = { id = SNB.6806 }
			}
		}

		character_event = { id = SNB.6804 days = 100 }
	}
}

#You're having withdrawal symptoms
character_event = {
	id = SNB.6805
	desc = EVTDESC_SNB_6805
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { NOT = { has_character_modifier = withdrawal_symptoms } }

	option = {
		name = EVTOPTA_SNB_6805

		add_character_modifier = {
			name = withdrawal_symptoms
			duration = -1
		}
	}
}

#Recovered from addiction
character_event = {
	id = SNB.6806
	desc = EVTDESC_SNB_6806
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hashish_addict
		has_character_modifier = withdrawal_symptoms
	}

	option = {
		name = EVTOPTA_SNB_6806

		remove_character_modifier = hashish_addict
		remove_character_modifier = withdrawal_symptoms
	}
}

#Special events
#Get Trait
#Three descs and options
character_event = {
	id = SNB.6810
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	desc = {
		trigger = { has_character_flag = become_gluttonous }
		text = EVTDESCA_SNB_6810
	}
	desc = {
		trigger = { has_character_flag = become_paranoid }
		text = EVTDESCB_SNB_6810
	}
	desc = {
		trigger = { has_character_flag = become_slothful }
		text = EVTDESCC_SNB_6810
	}
	desc = {
		trigger = { has_character_flag = become_possessed }
		text = EVTDESCD_SNB_6810
	}

	option = {
		name = EVTOPTA_SNB_6810
		if = {
			limit = {
				NOT = { trait = temperate }
			}
		add_trait = gluttonous
		}
		if = { 
			limit = { trait = temperate }
			remove_trait = temperate
		}
		clr_character_flag = become_gluttonous

		trigger = { has_character_flag = become_gluttonous }
	}

	option = {
		name = EVTOPTB_SNB_6810
		if = {
			limit  = {
				NOT = { trait = trusting }
			}
			add_trait = paranoid
		}
		if = { 
			limit = { trait = trusting }
			remove_trait = trusting
		}
		clr_character_flag = become_paranoid

		trigger = { has_character_flag = become_paranoid }
	}
	
	option = {
		name = EVTOPTC_SNB_6810
		if = {
			limit  = {
				NOT = { trait = diligent }
			}
			add_trait = slothful
		}
		if = { 
			limit = { trait = diligent }
			remove_trait = diligent
		}
		clr_character_flag = become_slothful

		trigger = { has_character_flag = become_slothful }
	}

	option = {
		name = EVTOPTD_SNB_6810
		add_trait = possessed
		clr_character_flag = become_possessed
		trigger = { has_character_flag = become_possessed }
	}
}

#Discover Plot
character_event = {
	id = SNB.6811
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		random_list = {
			40 = {
				modifier = {
					NOT= {
						top_liege = {
							any_realm_character = {
								plot_target_char = { character = ROOT }
								NOT = { plot_is_known_by = ROOT }
							}
						}
					}
					factor = 0
				}
				modifier = {
					NOT= {
						top_liege = {
							any_realm_lord = {
								plot_target_char = { character = ROOT }
								NOT = { plot_is_known_by = ROOT }
							}
						}
					}
					factor = 0.5
				}
				save_event_target_as = drug_plotter_target
				top_liege = {
					random_realm_character = {
						limit = {
							plot_target_char = { character = ROOT }
							NOT = { plot_is_known_by = ROOT }
						}
						save_event_target_as = drug_plotter_reveal
						character_event = { id = SNB.68111 }
					}
				}
				top_liege = {
					random_realm_lord = {
						limit = {
							plot_target_char = { character = ROOT }
							NOT = { plot_is_known_by = ROOT }
						}
						save_event_target_as = drug_plotter_reveal
						character_event = { id = SNB.68111 }
					}
				}
			}
			20 = {
				modifier = {
					NOT = {
						any_realm_character = {
							NOT = { plot_is_known_by = ROOT }
							plot_target_char = {
								dynasty = ROOT
							}
						}
					}
					factor = 0
				}
				modifier = {
					any_realm_lord = {
						plot_target_char = {
							dynasty = ROOT
						}
						NOT = { plot_is_known_by = ROOT }
					}
					factor = 1.5
				}
				random_realm_character = {
					limit = {
						has_plot = yes
						NOT = { plot_is_known_by = ROOT }
					}
					save_event_target_as = drug_plotter_reveal
					plot_target_char = {
						save_event_target_as = drug_plotter_target
					}
					character_event = { id = SNB.68111 }
				}
				random_realm_lord = {
					limit = {
						has_plot = yes
						NOT = { plot_is_known_by = ROOT }
						plot_target_char = {
							dynasty = ROOT
						}
					}
					save_event_target_as = drug_plotter_reveal
					plot_target_char = {
						save_event_target_as = drug_plotter_target
					}
					character_event = { id = SNB.68111 }
				}
			}
			10 = {
				modifier = {
					NOT = {
						any_realm_character = {
							has_plot = yes
							NOT = { plot_is_known_by = ROOT }
						}
					}
					factor = 0
				}
				random_realm_character = {
					limit = {
						has_plot = yes
						NOT = { plot_is_known_by = ROOT }
					} 
					save_event_target_as = drug_plotter_reveal
					plot_target_char = {
						save_event_target_as = drug_plotter_target
					}
					character_event = { id = SNB.68111 }

				}
			}
			1 = {
				top_liege = {
					random_realm_character = {
						limit = {
							has_plot = yes
							NOT = {
								plot_is_known_by = ROOT
							}
						}
						save_event_target_as = drug_plotter_reveal
						plot_target_char = {
							save_event_target_as = drug_plotter_target
						}
						character_event = { id = SNB.68111 }
					}
				}
			}
		}
	}
}
#Ping
character_event = {
	id = SNB.68111
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		FROM = {
			character_event = {
				id = SNB.68112 days = 4
			}
		}
	}
}
#Four Descs, one or two options
character_event = {
	id = SNB.68112
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes


	desc = {
		text = EVTDESCA_SNB_68112
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}

	desc = {
		text = EVTDESCB_SNB_68112
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}

	desc = {
		text = EVTDESCC_SNB_68112
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}

	desc = {
		text = EVTDESCD_SNB_68112
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}
	immediate = {
		event_target:drug_plotter_reveal = {
			reveal_plot = ROOT
		}
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTA_SNB_68112
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTB_SNB_68112
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTC_SNB_68112
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTD_SNB_68112
	}
}

#Gain Relation
#One desc and option
character_event = {
	id = SNB.6812
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_character_flag = drug_friend }
			create_character = {
				random_traits = yes
			}
			new_character = {
				remove_trait = trusting
				remove_trait = temperate
				remove_trait = celibate
				remove_trait = diligent
				add_trait = paranoid
				add_trait = gluttonous
				add_trait = hedonist
				add_trait = slothful
				save_event_target_as = slacker_buddy
			}
		}
		if = {
			limit = { has_character_flag = drug_lover }

			random_list = {
				10 = {
					modifier = {
						NOT = {
							any_spouse = {
								NOT = { is_lover = ROOT }
								opinion = {
									who = ROOT
									value = 0
								}
							}
						}
						factor = 0
					}
					random_spouse = {
						limit = {
							NOT = { is_lover = ROOT }
							opinion = {
								who = ROOT
								value = 0
							}
						}
						save_event_target_as = drug_new_lover
					}
				}
				5 = {
					modifier = {
						NOT = {
							any_courtier = {
								OR = {
									AND = {
										same_sex = ROOT
										trait = homosexual
										ROOT = {
											trait = homosexual
										}
									}
									AND = {
										is_opposite_sex = ROOT
										NOT = { 
											trait = homosexual
											ROOT = { trait = homosexual }
										}
									}
								}
								opinion = {
									who = ROOT
									value = 0
								}
							}
						}
					factor = 0
					}
					random_courtier = {
						limit = {
							OR = {
								AND = {
									same_sex = ROOT
									trait = homosexual
									ROOT = {
										trait = homosexual
									}
								}
								AND = {
									is_opposite_sex = ROOT
									NOT = { 
										trait = homosexual
										ROOT = { trait = homosexual }
									}
								}
							}
							opinion = {
								who = ROOT
								value = 0
							}
						}
						save_event_target_as = drug_new_lover
					}
				}
				5 = {
					if = {
						limit = {
							OR = {
								is_female = yes
								AND = {
									is_female = no
									trait = homosexual
								}
							}
						}
						create_character = {
							female = no
						}
						new_character = {
							save_event_target_as = drug_new_lover
						}
					}
					if = {
						limit = {
							OR = {
								is_female = no
								AND = {
									is_female = yes
									trait = homosexual
								}
							}
						}
						create_character = {
							female = yes
						}
						new_character = {
							save_event_target_as = drug_new_lover
						}
					}
				}
			}
		}
	}

	desc = {
		trigger = { has_character_flag = drug_friend }
		text = EVTDESCA_SNB_6812
		picture = GFX_evt_feast
	}
	option = {
		name = EVTOPTA_SNB_6812
		trigger = { has_character_flag = drug_friend }
		add_friend = event_target:slacker_buddy
		clr_character_flag = drug_friend
	}

	desc = {
		trigger = { has_character_flag = drug_lover }
		text = EVTDESCB_SNB_6812
		picture = GFX_evt_dark_love
	}
	option = {
		name = EVTOPTB_SNB_6812
		trigger = { has_character_flag = drug_lover }
		add_lover = event_target:drug_new_lover
		clr_character_flag = drug_lover
	}
}

#Cheating Spouse
#One desc and option, separate handling for "real" and "paranoid" affair
character_event = {
	id = SNB.6813
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	desc = EVTDESC_SNB_6813
	
	immediate = {
		random_spouse = {
			limit = {
				has_lover = yes
				NOT = {
					is_lover = ROOT
				}
			}
			save_event_target_as = drug_cheater_spouse
			random_lover = {
				limit = { NOT = { character = ROOT } }
				save_event_target_as = drug_cheater_lover
			}
		}
		random_spouse = {
			limit = {
				OR = {
					has_lover = no
					is_lover = ROOT
				}
			}
			random_realm_character = {
		 		limit = {
		 			same_sex = root
		 			NOT = { character = ROOT }
		 		}
		 		save_event_target_as = drug_cheater_lover
		 	}
			save_event_target_as = drug_cheater_spouse
			
		}
	}

	#reveal
	option = {
		name = EVTOPTA_SNB_6813
		if = {
			limit = {
				event_target:drug_cheater_lover = {
					is_opposite_sex = root
				}
			}
			event_target:drug_cheater_lover = {
				add_character_modifier = {
					name = known_sodomite
					days = -1
				}
			}
			event_target:drug_cheater_spouse = {
				add_character_modifier = {
					name = known_sodomite
					days = -1
				}
			}
		}
		if = {
			limit = {
				event_target:drug_cheater_lover = {
					same_sex = root
				}
				event_target:drug_cheater_spouse = {
					dynasty = event_target:drug_cheater_lover
				}
			}
			if = {
				limit = { is_female = no }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = incestuous_adulterer
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = incestuous_adulteress
						days = -1
					}
				}
			}
			if = {
				limit = { is_female = yes }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = incestuous_adulteress
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = incestuous_adulterer
						days = -1
					}
				}
			}
		}
		if = {
			limit = {
				event_target:drug_cheater_lover = {
					same_sex = root
				}
				NOT = {
					event_target:drug_cheater_spouse = {
						dynasty = event_target:drug_cheater_lover
					}
				}
			}
			if = {
				limit = { is_female = no }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = adulterer
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = adulteress
						days = -1
					}
				}
			}
			if = {
				limit = { is_female = yes }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = adulteress
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = adulterer
						days = -1
					}
				}
			}
		}
	}
	#keep to self
	option = {
		name = EVTOPTB_SNB_6813
		#opinion modifier?
	}
}

#Make a fool of yourself
#one desc and option
#drug fool 
character_event = {
	id = SNB.6814
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_SNB_6814
	option = {
		name = EVTOPTA_SNB_6814
		add_character_modifier = { name = foolish_behavior years = 3 }
		custom_tooltip = { text = EVTOPTA_SNB_6814_TOOLTIP }
	}
}

#Die
#One Desc and option
character_event = {
	id = SNB.6815
	picture = GFX_evt_impalement
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_SNB_6815
	option = {
		name = EVTOPTA_SNB_6815
		death = {
			death_reason = death_hashish_overdose
		}
	}
}


# Become cured of a bad trait
character_event = {
	id = SNB.6816
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_SNB_6816

	option = {
		name = EVTOPTA_SNB_6816
		trigger = {
			has_character_flag = drugs_curing_stressed
		}
		remove_trait = stressed
	}
	option = {
		name = EVTOPTB_SNB_6816
		trigger = {
			has_character_flag = drugs_curing_possessed
		}
		remove_trait = possessed
	}
	option = {
		name = EVTOPTC_SNB_6816
		trigger = {
			has_character_flag = drugs_curing_depressed
		}
		remove_trait = depressed
	}
	option = {
		name = EVTOPTD_SNB_6816
		trigger = {
			has_character_flag = drugs_curing_lunatic
		}
		remove_trait = lunatic
	}

	after = {
		hidden_effect = {
			clr_character_flag = drugs_curing_stressed
			clr_character_flag = drugs_curing_possessed
			clr_character_flag = drugs_curing_depressed
			clr_character_flag = drugs_curing_lunatic
		}
	}
}

#Gain insight
character_event = {
	id = SNB.6817
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_SNB_6817

	option = {
		name = EVTOPTA_SNB_6817
		trigger = {
			has_character_flag = gains_diplomatic_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = diplomatic_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTB_SNB_6817
		trigger = {
			has_character_flag = gains_martial_insight_flag
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = martial_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTA_SNB_6817
		trigger = {
			has_character_flag = gains_intrigue_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		add_character_modifier = {
			name = intrigue_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTD_SNB_6817
		trigger = {
			has_character_flag = gains_learning_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = learning_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTE_SNB_6817
		trigger = {
			has_character_flag = gains_stewardship_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = stewardship_insight
			days = 1825
		}
	}

	after = {
		clr_character_flag = gains_diplomatic_insight_flag
		clr_character_flag = gains_martial_insight_flag
		clr_character_flag = gains_intrigue_insight_flag
		clr_character_flag = gains_learning_insight_flag
		clr_character_flag = gains_stewardship_insight_flag
	}
}

#Cure your illness
character_event = {
	id = SNB.6818
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_SNB_6818

	option = {
		name = EVTOPTA_SNB_6818
		remove_disease_trait_effect = yes
	}
}


#POWER: Intimidate for favor
character_event = {
	id = SNB.6840
	desc = EVTDESC_SNB_6840
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6840
		tooltip = { FROMFROM  = { add_favor = ROOT } }
		opinion = {
			modifier = opinion_threatened_me
			who = FROMFROM
			years = 5
		}
		hidden_effect = { FROMFROM = { character_event = { id = SNB.6841 } } }
	}
}

character_event = {
	id = SNB.6841
	desc = EVTDESC_SNB_6841
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6841
		tooltip = { add_favor = FROM }
		tooltip = {
			reverse_opinion = {
				modifier = opinion_threatened_me
				who = FROMFROM
				years = 5
			}
		}
	}
}

#Fail 
character_event = {
	id = SNB.6980
	desc = EVTDESC_SNB_6980
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = CURSES
		reverse_opinion = {
			modifier = opinion_threatened_me
			who = FROM
			years = 5
		}
	}
}

#POWER: mark of death
#Confirmation of mark
character_event = {
	id = SNB.6842
	desc = EVTDESC_SNB_6842
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EXCELLENT
	}
}

#Confirmation of kill
letter_event = {
	id = SNB.6843
	desc = EVTDESC_SNB_6843
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EXCELLENT
	}
}

#Clearing the flag from GM
character_event = {
	id = SNB.6844
	hide_window = yes
	is_triggered_only = yes

	trigger = { has_character_flag = shinobi_target_marked_for_death }

	immediate = {
		random_society_member = { 
			limit = { 
				society_rank = {
					rank == 4
					society = the_shinobi
				}
				has_character_flag = shinobi_marked_someone_for_death 
			}
			clr_character_flag = shinobi_marked_someone_for_death
		}
	}
}


#MISSION: Train a protege
character_event = {
	id = SNB.6248
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = SNB.6249 days = 7 random = 7 } } }
}

society_quest_event = {
	id = SNB.6249
	desc = EVTDESC_SNB_6249
	title = quest_the_shinobi_protege

	is_triggered_only = yes

	option = {
		name = ACCEPT

		set_quest = quest_the_shinobi_protege

		hidden_effect = {
			character_event = { id = SNB.6250 days = 14 random = 60 } 
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}
		ai_chance = { factor = 0 }
	}
}

#Choose a child to train / A child is caught trying to pickpocket you
character_event = {
	id = SNB.6250
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	portrait = event_target:shinobi_protege

	trigger = {
		NOT = { has_character_flag = training_protege }
	}

	immediate = {
		hidden_effect = {
			set_character_flag = training_protege
			if = {
				limit = { has_character_flag = is_using_train_protege_decision }
				event_target:shinobi_protege = { save_event_target_as = shinobi_protege_1 } #for text purposes
			}
			else = { #Means you got this as a pulse-event
				random_child = {
					limit = {
						is_child_of = ROOT
						age = 12
						is_ruler = no
						is_abroad = no
						NOT = { any_spouse = { is_landed = yes } }
						NOT = { age = 21 }
						NOT = { has_character_flag = shinobi_protege_1_flag }
						OR = {
							is_female = no
							has_game_rule = {
								name = gender
								value = all
							}
						}
					}
					set_character_flag = shinobi_protege_1_flag
					save_event_target_as = shinobi_protege_1
				}
				random_child = {
					limit = {
						is_child_of = ROOT
						age = 12
						is_ruler = no
						is_abroad = no
						NOT = { any_spouse = { is_landed = yes } }
						NOT = { age = 21 }
						NOT = { has_character_flag = shinobi_protege_1_flag }
						NOT = { has_character_flag = shinobi_protege_2_flag }
						OR = {
							is_female = no
							has_game_rule = {
								name = gender
								value = all
							}
						}
					}
					set_character_flag = shinobi_protege_2_flag
					save_event_target_as = shinobi_protege_2
				}
				random_child = {
					limit = {
						is_child_of = ROOT
						age = 12
						is_ruler = no
						is_abroad = no
						NOT = { any_spouse = { is_landed = yes } }
						NOT = { age = 21 }
						NOT = { has_character_flag = shinobi_protege_1_flag }
						NOT = { has_character_flag = shinobi_protege_2_flag }
						NOT = { has_character_flag = shinobi_protege_3_flag }
						OR = {
							is_female = no
							has_game_rule = {
								name = gender
								value = all
							}
						}
					}
					set_character_flag = shinobi_protege_3_flag
					save_event_target_as = shinobi_protege_3
				}

				if = {
					limit = {
						NOR = {
							event_target:shinobi_protege_1 = { always = yes }
							event_target:shinobi_protege_2 = { always = yes }
							event_target:shinobi_protege_3 = { always = yes }
						}
					}
					random_list = {
						10 = {
							modifier = {
								factor = 0
								NOT = {
									has_game_rule = {
										name = gender
										value = all
									}
								}
							}

							create_character = {
								age = 12
								female = yes
								random_traits = yes
								attributes = {
									intrigue = 4
								}
								religion = ROOT
								dynasty = none
								race = ROOT
								culture = ROOT
							}
							new_character = {
								save_event_target_as = shinobi_protege
							}
						}
						10 = {
							create_character = {
								age = 12
								female = no
								random_traits = yes
								attributes = {
									intrigue = 4
								}
								religion = ROOT
								dynasty = none
								race = ROOT
								culture = ROOT
							}
							new_character = {
								save_event_target_as = shinobi_protege
							}
						}
					}
				}
			}
		}
	}

	desc = {
		text = EVTDESC_SNB_6250_A
		trigger = {
			OR = {
				event_target:shinobi_protege_1 = { always = yes }
				event_target:shinobi_protege_2 = { always = yes }
				event_target:shinobi_protege_3 = { always = yes }
			}
		}
	}
	desc = {
		text = EVTDESC_SNB_6250_B
		trigger = {
			NOR = {
				event_target:shinobi_protege_1 = { always = yes }
				event_target:shinobi_protege_2 = { always = yes }
				event_target:shinobi_protege_3 = { always = yes }
			}
		}
	}

	option = { #Begin training (ONLY for those who used the targeted decision to start this)
		name = EVTOPTA_SNB_6250
		custom_tooltip = { text = EVTOPTA_SNB_6250_TT }


		if = {
			limit = {
				event_target:shinobi_protege = { is_child_of = ROOT }
			}
			event_target:shinobi_protege = {
				show_scope_change = no
				opinion = {
					who = ROOT
					modifier = opinion_parental_praise
					years = 5
				}
			}
		}
		event_target:shinobi_protege = {
			hidden_effect = { character_event = { id = SNB.6251 } } # training ping event
		}
		show_portrait = event_target:shinobi_protege

		clr_character_flag = is_using_train_protege_decision

		trigger = {
			has_character_flag = is_using_train_protege_decision
		}
	}

	option = { #Choose random child 1
		name = EVTOPTA_SNB_6250
		custom_tooltip = { text = EVTOPTA_SNB_6250_TT }

		event_target:shinobi_protege_1 = {
			opinion = {
				who = ROOT
				modifier = opinion_parental_praise
				years = 5
			}
			save_event_target_as = shinobi_protege
			hidden_effect = { character_event = { id = SNB.6251 } } # training ping event
		}
		hidden_effect = {
			event_target:shinobi_protege_2 = {
				clr_character_flag = shinobi_protege_2_flag
			}
			event_target:shinobi_protege_3 = {
				clr_character_flag = shinobi_protege_3_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = shinobi_protege_1_flag
			}
		}
	}
	option = { #Choose random child 2
		name = EVTOPTB_SNB_6250
		custom_tooltip = { text = EVTOPTB_SNB_6250_TT }
		
		event_target:shinobi_protege_2 = {
			opinion = {
				who = ROOT
				modifier = opinion_parental_praise
				years = 5
			}
			save_event_target_as = shinobi_protege
			hidden_effect = { character_event = { id = SNB.6251 } } # training ping event
		}
		hidden_effect = {
			event_target:shinobi_protege_1 = {
				clr_character_flag = shinobi_protege_1_flag
			}
			event_target:shinobi_protege_3 = {
				clr_character_flag = shinobi_protege_3_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = shinobi_protege_2_flag
			}
		}
	}
	option = { #Choose random child 3 
		name = EVTOPTC_SNB_6250
		custom_tooltip = { text = EVTOPTC_SNB_6250_TT }

		event_target:shinobi_protege_3 = {
			opinion = {
				who = ROOT
				modifier = opinion_parental_praise
				years = 5
			}
			save_event_target_as = shinobi_protege
			hidden_effect = { character_event = { id = SNB.6251 } } # training ping event
		}
		hidden_effect = {
			event_target:shinobi_protege_1 = {
				clr_character_flag = shinobi_protege_1_flag
			}
			event_target:shinobi_protege_2 = {
				clr_character_flag = shinobi_protege_2_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = shinobi_protege_3_flag
			}
		}
	}
	option = { # Take the child under your wing
		name = EVTOPTD_SNB_6250
		custom_tooltip = { text = EVTOPTD_SNB_6250_TT }
		set_character_flag = apprentice_is_not_bloodrelation

		event_target:shinobi_protege = {
			opinion = {
				who = ROOT
				modifier = opinion_was_shown_mercy
				years = 5
			}
			hidden_effect = { character_event = { id = SNB.6251 } } # training ping event
		}
		trigger = {
			NOR = {
				event_target:shinobi_protege_1 = { always = yes }
				event_target:shinobi_protege_2 = { always = yes }
				event_target:shinobi_protege_3 = { always = yes }
			}
		}
	}
	option = { #Imprison the urchin!
		name = EVTOPTE_SNB_6250
		custom_tooltip = { text = EVTOPTE_SNB_6250_TT }

		clr_quest = { id = quest_the_shinobi_protege failure = yes }

		hidden_effect = {
			event_target:shinobi_protege = {
				imprison = ROOT
			}
		}
		trigger = {
			NOR = {
				event_target:shinobi_protege_1 = { always = yes }
				event_target:shinobi_protege_2 = { always = yes }
				event_target:shinobi_protege_3 = { always = yes }
			}
		}
	}
	option = { # You are busy right now
		name = EVTOPTF_SNB_6250
		custom_tooltip = { text = EVTOPTF_SNB_6250_TT }

		clr_quest = { id = quest_the_shinobi_protege failure = yes }

		hidden_effect = {
			any_child = {
				clr_character_flag = shinobi_protege_1_flag
				clr_character_flag = shinobi_protege_2_flag
				clr_character_flag = shinobi_protege_3_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = shinobi_protege_1_flag
			}
		}
	}
}

character_event = { # ping event
	id = SNB.6251
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_window = yes

	option = {
		clr_character_flag = shinobi_protege_1_flag
		clr_character_flag = shinobi_protege_2_flag
		clr_character_flag = shinobi_protege_3_flag
		set_quest_target = {
	        id = quest_the_shinobi_protege
	        society = the_shinobi
	        holder = FROM
		}
		hidden_effect = { FROM = { character_event = { id = SNB.6252 days = 60 random = 20 } } } # specialization event
	}
}

character_event = { # choose specialization for kid
	id = SNB.6252
	desc = EVTDESC_SNB_6252
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	portrait = event_target:shinobi_protege

	trigger = { has_character_flag = training_protege }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6252
		custom_tooltip = { text = EVTOPTA_SNB_6252_TT }
		set_character_flag = chose_intrigue_focus

		hidden_effect = { character_event = { id = SNB.6253 days = 90 random = 60 } } # intrigue focus
	}
	option = {
		name = EVTOPTB_SNB_6252
		custom_tooltip = { text = EVTOPTB_SNB_6252_TT }
		set_character_flag = chose_martial_focus

		hidden_effect = { character_event = { id = SNB.6253 days = 90 random = 60 } } # martial focus
	}
	option = {
		name = EVTOPTC_SNB_6252
		custom_tooltip = { text = EVTOPTC_SNB_6252_TT }
		set_character_flag = chose_even_focus

		hidden_effect = { character_event = { id = SNB.6253 days = 90 random = 60 } } # even focus
	}
}

character_event = { # they are hard at work and time has come for a test
	id = SNB.6253
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	portrait = event_target:shinobi_protege

	trigger = {
		has_character_flag = training_protege
	}

	is_triggered_only = yes

	desc = {
		trigger = {	has_character_flag = chose_intrigue_focus }
		text = EVTDESC_SNB_6253_A
	}
	desc = {
		trigger = {	has_character_flag = chose_martial_focus }
		text = EVTDESC_SNB_6253_B
	} 
	desc = {
		trigger = {	has_character_flag = chose_even_focus }
		text = EVTDESC_SNB_6253_C
	}

	option = {
		name = EVTOPTA_SNB_6253
		custom_tooltip = { text = EVTOPTA_SNB_6253_TT }

		if = {
			limit = { has_character_flag = chose_intrigue_focus }
			event_target:shinobi_protege = {
				add_trait_deceitful_effect = yes
				remove_trait_honest_effect = yes
			}
		}
		if = {
			limit = { has_character_flag = chose_martial_focus }
			event_target:shinobi_protege = {
				add_trait_brave_effect = yes
				remove_trait_craven_effect = yes
			}
		}
		if = {
			limit = { has_character_flag = chose_even_focus }
			event_target:shinobi_protege = {
				add_trait_diligent_effect = yes
				remove_trait_slothful_effect = yes
			}
		}

		hidden_effect = {
			random_list = {
				10 = {
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 3 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 4 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 5 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 6 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 7 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 8 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 9 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { martial = 10 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 3 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 4 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 5 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 6 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 7 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 8 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 9 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { intrigue = 10 }
					}
					modifier = {
						factor = 1.1
						event_target:shinobi_protege = { trait = deceitful }
					}
					modifier = {
						factor = 1.5
						event_target:shinobi_protege = {
							OR = {
								trait = shrewd
								trait = quick
								trait = genius
							}
						}
					}
					character_event = { id = SNB.6254 days = 5 } # good outcome 1
				}
				10 = {
					character_event = { id = SNB.6255 days = 5 } # mediocre outcome 1
				}
				5 = {
					modifier = {
						factor = 10
						event_target:shinobi_protege = {
							OR = {
								trait = slow
								trait = imbecile
								trait = dull
							}
						}
					}
					character_event = { id = SNB.6256 days = 5 } # bad outcome 1
				}
			}
		}

		trigger = {	has_character_flag = chose_intrigue_focus }
	}
}

character_event = { # good outcome
	id = SNB.6254
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	portrait = event_target:shinobi_protege

	hide_from = yes

	trigger = { has_character_flag = training_protege }

	is_triggered_only = yes

	desc = {
		trigger = {	has_character_flag = chose_intrigue_focus }
		text = EVTDESC_SNB_6254_A
	}
	desc = {
		trigger = {	has_character_flag = chose_martial_focus }
		text = EVTDESC_SNB_6254_B
	}
	desc = {
		trigger = {	has_character_flag = chose_even_focus }
		text = EVTDESC_SNB_6254_C
	}

	option = {
		name = EVTOPTA_SNB_6254
		custom_tooltip = { text = EVTOPTA_SNB_6254_TT }
		set_character_flag = apprentice_did_great
		character_event = { id = SNB.6261 days = 25 }
	}
}

character_event = { # mediocre outcome
	id = SNB.6255
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	portrait = event_target:shinobi_protege
	
	trigger = { has_character_flag = training_protege }

	is_triggered_only = yes

	desc = {
		trigger = {	has_character_flag = chose_intrigue_focus }
		text = EVTDESC_SNB_6255_A
	}
	desc = {
		trigger = {	has_character_flag = chose_martial_focus }
		text = EVTDESC_SNB_6255_B
	}
	desc = {
		trigger = {	has_character_flag = chose_even_focus }
		text = EVTDESC_SNB_6255_C
	}

	option = {
		name = EVTOPTA_SNB_6255
		custom_tooltip = { text = EVTOPTA_SNB_6255_TT }
		set_character_flag = apprentice_did_ok
		
		event_target:shinobi_protege = {
			add_maimed_trait_effect = yes
		}

		character_event = { id = SNB.6261 days = 25 }
	}
}

character_event = { # bad outcome
	id = SNB.6256
	desc = EVTDESC_SNB_6256
	picture = GFX_evt_shinobiation
	border = GFX_event_normal_frame_intrigue

	portrait = event_target:shinobi_protege

	hide_from = yes

	has_character_flag = training_protege

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SNB_6256
		custom_tooltip = { text = EVTOPTA_SNB_6256_TT }
		set_character_flag = apprentice_failed_miserably

		event_target:shinobi_protege = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}

		character_event = { id = SNB.6259 days = 10 }

		trigger = {
			event_target:shinobi_protege = {
				NOT = { is_child_of = ROOT }
			}
		}
	}
	option = {
		name = EVTOPTB_SNB_6256
		custom_tooltip = { text = EVTOPTB_SNB_6256_TT }
		set_character_flag = apprentice_failed_miserably
		character_event = { id = SNB.6259 days = 10 }

		event_target:shinobi_protege = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}

		trigger = {
			event_target:shinobi_protege = {
				is_child_of = ROOT
			}
		}
	}
}

character_event = { # clean-up after training apprentice
	id = SNB.6257
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_window = yes

	option = {
		if = { limit = { event_target:shinobi_protege = { true_religion_shiite_trigger = no } }
			custom_tooltip = { text = 6252_CONVERT_APPRENTICE_TT }
			event_target:shinobi_protege = {
				character_event = { id = SNB.6258 } # convert
			}
		}
		event_target:shinobi_protege = { clr_character_flag = show_picture_in_option }
		clr_character_flag = training_protege
		clr_character_flag = chose_intrigue_focus
		clr_character_flag = chose_martial_focus
		clr_character_flag = chose_even_focus
		clr_character_flag = apprentice_is_not_bloodrelation
		clr_character_flag = apprentice_did_great
		clr_character_flag = apprentice_did_ok
		clr_character_flag = apprentice_failed_miserably
	}
}

character_event = { # Conversion event (for apprentice) if they are not already Shia (sent from SNB.6052)
	id = SNB.6258
	desc = EVTDESC_SNB_6258
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	trigger = {
		event_target:shinobi_protege = { is_alive = yes }
		true_religion_shiite_trigger = no
	}

	is_triggered_only = yes

	option = { #I (apprentice)  will convert
		name = EVTOPTA_SNB_6258
		
		religion = nihon_shinto
		
		ai_chance = {
			factor = 20

			modifier = {
				true_religion_group_muslim_trigger = yes
				factor = 2
			}
			modifier = {
				independent = yes
				factor = 2
			}
			modifier = {
				trait = brave
				factor = 2
			}
			modifier = {
				trait = honest
				factor = 2
			}
		}
	}
	option = { # I (apprentice) will convert, secretly
		name = EVTOPTB_SNB_6258
		
		clear_secret_religion = yes
		set_secret_religion = nihon_shinto

		ai_chance = {
			factor = 80
			modifier = {
				trait = craven
				factor = 2
			}
			modifier = {
				trait = deceitful
				factor = 2
			}
		}
	}
}

character_event = { # Final talk with apprentice
	id = SNB.6259
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	portrait = event_target:shinobi_protege

	has_character_flag = training_protege

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_character_flag = apprentice_failed_miserably }
			clr_character_flag = training_protege #to block extra fallback spam
		}
	}

	desc = {
		trigger = {
			has_character_flag = apprentice_did_great
			event_target:shinobi_protege = { true_religion_shiite_trigger = yes }
		}
		text = EVTDESC_SNB_6259_A # apprentice is a fine example and already a believer
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_did_ok
			event_target:shinobi_protege = { true_religion_shiite_trigger = yes }
		}
		text = EVTDESC_SNB_6259_B # Apprentice has done alright, all things considered
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_failed_miserably
			event_target:shinobi_protege = { true_religion_shiite_trigger = yes }
		}
		text = EVTDESC_SNB_6259_C # believer apprentice is dead, I might train a new one?
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_did_great
			event_target:shinobi_protege = { true_religion_shiite_trigger = no }
		}
		text = EVTDESC_SNB_6259_D # apprentice is a fine example and already a believer
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_did_ok
			event_target:shinobi_protege = { true_religion_shiite_trigger = no }
		}
		text = EVTDESC_SNB_6259_E # Apprentice has done alright, all things considered AND will convert
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_failed_miserably
			event_target:shinobi_protege = { true_religion_shiite_trigger = no }
		}
		text = EVTDESC_SNB_6259_F # to-be-converted apprentice is dead, I might train a new one?
	}


	option = {
		name = EVTOPTA_SNB_6259 # Great!
		clr_quest = quest_the_shinobi_protege
		sound_effect = shinobi_train_protege
		add_society_currency_medium_effect = yes
		hidden_effect = { character_event = { id = SNB.6257 } } # clean up
		event_target:shinobi_protege = { set_character_flag = show_picture_in_option }

		if = { limit = { event_target:shinobi_protege = { true_religion_shiite_trigger = no } }
			custom_tooltip = { text = 6252_CONVERT_APPRENTICE_TT_2 }
			event_target:shinobi_protege = {
				character_event = { id = SNB.6258 } # convert
			}
		}
		event_target:shinobi_protege = {
			clr_character_flag = show_picture_in_option
			set_character_flag = was_trained_as_shinobi_protege
		}
		trigger = {	has_character_flag = apprentice_did_great }
	}

	option = {
		name = EVTOPTB_SNB_6259 # OK
		clr_quest = quest_the_shinobi_protege
		sound_effect = shinobi_train_protege
		add_society_currency_minor_effect = yes
		hidden_effect = { character_event = { id = SNB.6257 } } # clean up
		event_target:shinobi_protege = { set_character_flag = show_picture_in_option }
		if = { limit = { event_target:shinobi_protege = { true_religion_shiite_trigger = no } }
			custom_tooltip = { text = 6252_CONVERT_APPRENTICE_TT_2 }
			event_target:shinobi_protege = {
				character_event = { id = SNB.6258 } # convert
			}
		}
		event_target:shinobi_protege = {
			clr_character_flag = show_picture_in_option
			set_character_flag = was_trained_as_shinobi_protege
		}
		trigger = {	has_character_flag = apprentice_did_ok }
	}

	option = {
		name = EVTOPTC_SNB_6259 # Typical
		clr_quest = { id = quest_the_shinobi_protege failure = yes }
		hidden_effect = { character_event = { id = SNB.6257 } } # clean up
		event_target:shinobi_protege = { set_character_flag = show_picture_in_option }
		event_target:shinobi_protege = { clr_character_flag = show_picture_in_option }
		trigger = {	has_character_flag = apprentice_failed_miserably }
	}
}


character_event = { # Fallback - apprentice has died somehow during chain
	id = SNB.6260
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	has_character_flag = training_protege

	is_triggered_only = yes

	desc = {
		trigger = { NOT = { has_character_flag = apprentice_is_not_bloodrelation } }
		text = EVTDESC_SNB_6260_A
	}
	desc = {
		trigger = { has_character_flag = apprentice_is_not_bloodrelation }
		text = EVTDESC_SNB_6260_B
	}


	option = {
		name = EVTOPTA_SNB_6260 # Drat
		clr_quest = { id = quest_the_shinobi_protege failure = yes }
		hidden_effect = { character_event = { id = SNB.6257 } } # clean up
	}
}

character_event = { #Fallback doublecheck - apprentice died before the shinobi could be notified of the success (leads to fail of mission)
    id = SNB.6261
    hide_window = yes

	has_character_flag = training_protege

    is_triggered_only = yes
    
    immediate = {
    	if = {
    		limit = { event_target:shinobi_protege = { is_alive = yes } }
    		character_event = { id = SNB.6259 }
    	}
    }
}

###INTERACTIONS###

#Interaction: Friend or foe?
character_event = {
	id = SNB.6899
	hide_window = yes

	min_age = 16
	only_playable = yes
	only_capable = yes
	prisoner = no
	has_dlc = "Mystics"
	is_in_society = yes

	is_triggered_only = yes

	trigger = {
		society_member_of = the_shinobi
		NOR = {
			has_character_modifier = won_duel
			has_character_modifier = outwitted_opponent
			has_character_modifier = focused_on_training
		}
		society = {
			any_society_member = {
				block_general_event_trigger = no
				ai = yes
				ROOT = { same_society_rank_as_prev_trigger = yes }
				NOR = {
					trait = incapable
					prisoner = yes
					is_rival = ROOT
					is_friend = ROOT
					is_lover = ROOT
					is_close_relative = ROOT
				}
			}
		}
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					ROOT = { same_society_rank_as_prev_trigger = yes }
					NOR = {
						trait = incapable
						prisoner = yes
						is_rival = ROOT
						is_friend = ROOT
						is_lover = ROOT
						is_close_relative = ROOT
					}
				}
				save_event_target_as = friend_or_foe
			}
		}
		society = {
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					ROOT = { same_society_rank_as_prev_trigger = yes }
					NOR = {
						trait = incapable
						prisoner = yes
						is_rival = ROOT
						is_friend = ROOT
						is_lover = ROOT
						is_close_relative = ROOT
					}
					age_diff = { who = ROOT years = 5 }
				}
				save_event_target_as = friend_or_foe
			}
		}
		event_target:friend_or_foe = { character_event = { id = SNB.6900 } }
	}
}

character_event = {
	id = SNB.6900
	hide_window = yes
	is_triggered_only = yes
	immediate = { FROM = { character_event = { id = SNB.6901 } } }
}


#They're so infuriating! What do?
character_event = {
    id = SNB.6901
    desc = EVTDESC_SNB_6901
    picture = GFX_evt_quarrel
    border = GFX_event_normal_frame_war

    is_triggered_only = yes
    
    #Challenge him/her
    option = { 
        name = EVTOPTA_SNB_6901
        custom_tooltip = { text = EVTOPTA_SNB_6901_TT }

        hidden_effect = {
        	random_list = {
        		17 = { #Win - outwit
        			modifier = { is_smart_trigger = yes factor = 2 }
        			modifier = { FROM = { is_dumb_trigger = yes } factor = 2 }
        			modifier = { trait = erudite factor = 2 }
        			modifier = { attribute_diff = { character = FROM attribute = intrigue value = 3 } factor = 2 }

        			set_character_flag = won_outwit

     				random_list = {
     					75 = { set_character_flag = modifier_outwit }
     					25 = { 
     						modifier = { OR = { is_smart_trigger = yes is_dumb_trigger = yes } factor = 0 }
     						set_character_flag = trait_shrewd
     					}
     				}
        		}
        		17 = { #Win - outstrong
        			modifier = { is_strong_trigger = yes factor = 2 }
        			modifier = { FROM = { is_weak_trigger = yes } factor = 2 }
        			modifier = { combat_rating_diff = { who = FROM value = 10 } factor = 2 } 
        			modifier = { attribute_diff = { character = FROM attribute = martial value = 3 } factor = 2 }

        			set_character_flag = won_outstrong

        			random_list = {
	        			75 = { set_character_flag = modifier_outstrong }
	 					25 = { 
	 						modifier = { OR = { is_strong_trigger = yes is_weak_trigger = yes } factor = 0 }
	 						set_character_flag = trait_robust
	 					}
        			}
        		}
        		33 = {
        			set_character_flag = draw
        		}
        		17 = { #Lose - outwit
        			modifier = { FROM = { is_smart_trigger = yes } factor = 2 }
        			modifier = { is_dumb_trigger = yes factor = 2 }
        			modifier = { FROM = { trait = erudite } factor = 2 }
        			modifier = { FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 3 } } factor = 2 }

     				set_character_flag = lost_outwit
        		}
        		17 = { #Lose - outstrong
        			modifier = { FROM = { is_strong_trigger = yes } factor = 2 }
        			modifier = { is_weak_trigger = yes factor = 2 }
        			modifier = { FROM = { combat_rating_diff = { who = ROOT value = 10 } } factor = 2 } 
        			modifier = { FROM = { attribute_diff = { character = ROOT attribute = martial value = 3 } } factor = 2 }

        			set_character_flag = lost_outstrong
        		}
        	}

        	FROM = { character_event = { id = SNB.6902 } }
        }
    }

    #Ignore him/her
    option = {
        name = EVTOPTB_SNB_6901
        custom_tooltip = { text = EVTOPTB_SNB_6901_TT }

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_very_disappointed
        	years = 10
        }

        add_character_modifier = {
        	name = focused_on_training
        	years = 5
        }
    }
}

#Ping event outcome
character_event = {
	id = SNB.6902
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			50 = {
				modifier = { is_benevolent_trigger = yes factor = 2 }
				modifier = { has_pleasant_personality_trigger = yes factor = 1.3 }
				modifier = { trait = content factor = 1.3 }
				modifier = { opinion = { who = FROM value = 30 } factor = 1.5 }
				FROM = { set_character_flag = nice_opponent }
			}
			50 = {
				modifier = { is_evil_trigger = yes factor = 2 }
				modifier = { has_unpleasant_personality_trigger = yes factor = 1.3 }
				modifier = { trait = ambitious factor = 1.2 }
				modifier = { NOT = { opinion = { who = FROM value = 0 } } factor = 1.3 } 
				FROM = { set_character_flag = mean_opponent }
			}
		}

		#Challenge is set
		FROM = {
			character_event = { id = SNB.6908 days = 14 }
		}

		#Outcome
		FROM = {	
			#Nice win
			if = {
				limit = { 
					OR = {
						has_character_flag = won_outwit
						has_character_flag = won_outstrong
					}
					has_character_flag = nice_opponent
				}
				character_event = { id = SNB.6903 days = 20 }
			}
			#Mean win
			if = {
				limit = { 
					OR = {
						has_character_flag = won_outwit
						has_character_flag = won_outstrong
					}
					has_character_flag = mean_opponent
				}
				character_event = { id = SNB.6904 days = 20 }
			}
			#Draw
			if = {
				limit = { has_character_flag = draw }
				character_event = { id = SNB.6903 days = 20 }
			}
			#Nice lose
			if = {
				limit = { 
					OR = {
						has_character_flag = lost_outwit
						has_character_flag = lost_outstrong
					}
					has_character_flag = nice_opponent
				}
				character_event = { id = SNB.6903 days = 20 }
			}
			#Mean lose
			if = {
				limit = { 
					OR = {
						has_character_flag = lost_outwit
						has_character_flag = lost_outstrong
					}
					has_character_flag = mean_opponent
				}
				character_event = { id = SNB.6905 days = 20 }
			}
		}
	}
}

character_event = {
    id = SNB.6908
    picture = GFX_evt_market_byzantine
    border = GFX_event_normal_frame_war

    desc = {
    	trigger = {
    		OR = {
    			has_character_flag = won_outwit
    			has_character_flag = lost_outwit
    		}
    	}
    	text = EVTDESC_SNB_6908_A
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = {
    		OR = {
    			has_character_flag = lost_outstrong
    			has_character_flag = won_outstrong
    			has_character_flag = draw
    		}
    	}
    	text = EVTDESC_SNB_6908_B
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes
    
    option = { 
        name = EVTOPTA_SNB_6908
        custom_tooltip = { text = EVTOPTA_SNB_6908_TT }
    }
}

#Nice win/draw/nice lose
character_event = {
    id = SNB.6903
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_market_byzantine

    desc = {
    	trigger = { has_character_flag = won_outwit }
    	text = EVTDESC_SNB_6903_A
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = { has_character_flag = won_outstrong }
    	text = EVTDESC_SNB_6903_B
    	picture = GFX_evt_melee
    }
    desc = {
    	trigger = { has_character_flag = draw }
    	text = EVTDESC_SNB_6903_C
    	picture = GFX_evt_melee
    }
    desc = {
    	trigger = { has_character_flag = lost_outwit }
    	text = EVTDESC_SNB_6903_D
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = { has_character_flag = lost_outstrong }
    	text = EVTDESC_SNB_6903_E
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes
    
    #Friends
    option = { 
        name = EVTOPTA_SNB_6903

        add_friend = FROM
    }

    #Love?
    option = {
    	trigger = { FROM = { root_attraction_trigger = yes } }
        name = EVTOPTB_SNB_6903
        custom_tooltip = { text = EVTOPTB_SNB_6903_TT }

        hidden_effect = { FROM = { character_event = { id = SNB.6906 days = 3 } } }

        ai_chance = {
        	factor = 1
        	modifier = {
        		factor = 0
        		NOR = {
        			trait = lustful
        			AND = {
        				NOT = { any_lover = { is_alive = yes } }
        				is_married = yes
        			}
        			FROM = { has_attractive_trait_trigger = yes }
        		}
        	}
        }
    }
    
    #Glory
    option = {
    	trigger = {
    		OR = {
    			has_character_flag = won_outwit
    			has_character_flag = won_outstrong
    		}
    	}
        name = EVTOPTC_SNB_6903
        custom_tooltip = { text = EVTOPTC_SNB_6903_TT }

        prestige = 100
        add_society_currency_major_effect = yes
    }
    
    after = {
    	if = {
    		limit = { has_character_flag = modifier_outwit }
    		add_character_modifier = {
    			name = outwitted_opponent
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_shrewd }
    		add_trait = shrewd
    	}
    	if = {
    		limit = { has_character_flag = modifier_outstrong }
    		add_character_modifier = {
    			name = won_duel
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_robust }
    		add_trait = robust
    	}
    	hidden_effect = {
    		clr_character_flag = won_outwit
    		clr_character_flag = won_outstrong
    		clr_character_flag = draw
    		clr_character_flag = lost_outwit
    		clr_character_flag = lost_outstrong
    		clr_character_flag = nice_opponent
			clr_character_flag = mean_opponent
    		clr_character_flag = modifier_outwit
    		clr_character_flag = trait_shrewd
    		clr_character_flag = modifier_outstrong
    		clr_character_flag = trait_robust
    	}
    }
}

#Mean win
character_event = {
    id = SNB.6904
    border = GFX_event_normal_frame_war
    picture = GFX_evt_market_byzantine

    desc = {
    	trigger = { has_character_flag = won_outwit }
    	text = EVTDESC_SNB_6904_A
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = { has_character_flag = won_outstrong }
    	text = EVTDESC_SNB_6904_B
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes

    #Beat
    option = { 
        name = EVTOPTA_SNB_6904
        custom_tooltip = { text = EVTOPTA_SNB_6904_TT }

        add_rival = FROM
        
        FROM = {
        	if = {
	        	limit = { NOT = { trait = wounded } }
	        	add_trait = wounded
        	}
        }
    }

    #Let it be
    option = {
        name = EVTOPTB_SNB_6904
        custom_tooltip = { text = EVTOPTB_SNB_6904_TT }

        prestige = 100
        add_society_currency_major_effect = yes
    }

    after = {
    	if = {
    		limit = { has_character_flag = modifier_outwit }
    		add_character_modifier = {
    			name = outwitted_opponent
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_shrewd }
    		add_trait = shrewd
    	}
    	if = {
    		limit = { has_character_flag = modifier_outstrong }
    		add_character_modifier = {
    			name = won_duel
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_robust }
    		add_trait = robust
    	}
    	hidden_effect = {
    		clr_character_flag = won_outwit
    		clr_character_flag = won_outstrong
    		clr_character_flag = mean_opponent
    		clr_character_flag = modifier_outwit
    		clr_character_flag = trait_shrewd
    		clr_character_flag = modifier_outstrong
    		clr_character_flag = trait_robust
    	}
    }
}	

#Mean lose
character_event = {
    id = SNB.6905
    border = GFX_event_normal_frame_war
    picture = GFX_evt_assassination

    desc = {
    	trigger = { has_character_flag = lost_outwit }
    	text = EVTDESC_SNB_6905_A
    	picture = GFX_evt_assassination
    }
    desc = {
    	trigger = { has_character_flag = lost_outstrong }
    	text = EVTDESC_SNB_6905_B
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes
    
    option = { 
        name = EVTOPTA_SNB_6905

        add_rival = FROM
        if = {
        	limit = { NOT = { trait = wounded } }
        	add_trait = wounded
        }
    }

    after = {
    	clr_character_flag = lost_outwit
    	clr_character_flag = lost_outstrong
		clr_character_flag = mean_opponent
		clr_character_flag = modifier_outwit
		clr_character_flag = trait_shrewd
		clr_character_flag = modifier_outstrong
		clr_character_flag = trait_robust
    }
}

#Love ping event
character_event = {
	id = SNB.6906
	hide_window = yes
	is_triggered_only = yes
	immediate = { 

		random_list = {
    		50 = { #Not interested
    			modifier = { is_married = yes factor = 2 }
    			modifier = { any_lover = { is_alive = yes } factor = 4 }
    			modifier = { trait = chaste factor = 4 }
    			modifier = { trait = celibate factor = 10 }
    			modifier = { has_unpleasant_trait_trigger = yes factor = 2 }
    			modifier = { NOT = { opinion = { who = FROM value = 20 } } factor = 2 }
    			modifier = { 
					root_attraction_trigger = no 
					NOT = { trait = homosexual }
					factor = 0.5 
    			}
    			modifier = { 
					root_attraction_trigger = no 
					trait = homosexual
					factor = 0
    			}
    			set_character_flag = not_interested
    		} 
    		50 = { #Interested
    			modifier = { trait = lustful factor = 4 }
    			modifier = { has_pleasant_trait_trigger = yes factor = 2 }
    			modifier = { opinion = { who = FROM value = 40 } factor = 2 }
    			modifier = { FROM = { has_attractive_trait_trigger = yes } factor = 3 }

    			set_character_flag = interested

    			if = {
    				limit = { same_sex = FROM }
    				add_trait = homosexual 
    			}
    		}
    	}

		FROM = { character_event = { id = SNB.6907 } }
	}
}

#Love outcome
character_event = {
    id = SNB.6907
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_lovers

    desc = {
    	trigger = { FROM = { has_character_flag = not_interested } }
    	text = EVTDESC_SNB_6907_A
    	picture = GFX_evt_courtiers_talking
    }
    desc = {
    	trigger = { FROM = { has_character_flag = interested } }
    	text = EVTDESC_SNB_6907_B
    	picture = GFX_evt_lovers
    }

    is_triggered_only = yes

    #Friends instead?
    option = {
    	trigger = { FROM = { has_character_flag = not_interested } }
        name = EVTOPTC_SNB_6907

        add_friend = FROM
    }

    #Nah
    option = { 
    	trigger = { FROM = { has_character_flag = not_interested } } 
        name = EVTOPTA_SNB_6907

        opinion = {
        	modifier = opinion_distressing_encounter
        	who = FROM
        	years = 5
        }
        reverse_opinion = {
        	modifier = opinion_distressing_encounter
        	who = FROM
        	years = 5
        }
    }

    #Love
    option = {
    	trigger = { FROM = { has_character_flag = interested } }
        name = EVTOPTB_SNB_6907

        add_lover = FROM
    }

    after = {
    	hidden_effect = {
    		FROM  = {
    			clr_character_flag = not_interested
    			clr_character_flag = interested
    		}
    	}
    }
}

#Interaction: Help someone's murder plot
character_event = {
	id = SNB.6910
	hide_window = yes

	min_age = 16
	only_playable = yes
	only_capable = yes
	prisoner = no
	is_in_society = yes

	is_triggered_only = yes

	trigger = {
		society_member_of = the_shinobi
		society = {
			any_society_member = {
				block_general_event_trigger = no
				ai = yes
				society_rank >= 2
				has_quest = quest_the_shinobi_assassination
				NOT = { any_plot_backer = { character = ROOT } }
				OR = {
					AND = {
						has_plot = plot_kill_character
						plot_target_char = { is_quest_target_of = PREV }
					}
					AND = {
						has_plot = plot_kill_spouse
						plot_target_char = { is_quest_target_of = PREV }
					}
				}
			}
		}
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					society_rank >= 2
					has_quest = quest_the_shinobi_assassination
					NOT = { any_plot_backer = { character = ROOT } }
					OR = {
						AND = {
							has_plot = plot_kill_character
							plot_target_char = { is_quest_target_of = PREV }
						}
						AND = {
							has_plot = plot_kill_spouse
							plot_target_char = { is_quest_target_of = PREV }
						}
					}
				}
				save_event_target_as = shinobi_plotter
			}
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					society_rank >= 3
					has_quest = quest_the_shinobi_assassination
					NOT = { any_plot_backer = { character = ROOT } }
					OR = {
						AND = {
							has_plot = plot_kill_character
							plot_target_char = { is_quest_target_of = PREV }
						}
						AND = {
							has_plot = plot_kill_spouse
							plot_target_char = { is_quest_target_of = PREV }
						}
					}
				}
				save_event_target_as = shinobi_plotter
			}
		}
		event_target:shinobi_plotter = { character_event = { id = SNB.6911 } }
	}
}


character_event = {
    id = SNB.6911
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = SNB.6912 } } }
}

#I can offer my help, but against what?
character_event = {
    id = SNB.6912
    desc = EVTDESC_SNB_6912
    picture = GFX_evt_assassination
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes
    
    immediate = {
    	FROM = { plot_target_char = { save_event_target_as = assassin_quest_target } }
    	plot_target_char = { save_event_target_as = my_quest_target }
    }

    #You scratch my back, I scratch yours
    option = { 
    	trigger = { 
    		has_quest = quest_the_shinobi_assassination
    		plot_target_char = { is_quest_target_of = ROOT }
    	}
        name = EVTOPTA_SNB_6912

        FROM = { back_plot = ROOT }

        back_plot = FROM

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_grateful
        	years = 10
        }

        ai_chance = { factor = 100 }
    }

    #Some influence
    option = {
        name = EVTOPTB_SNB_6912

        add_society_currency_medium_effect = yes

        back_plot = FROM

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_grateful
        	years = 10
        }

        ai_chance = { factor = 50 }
    }
    
    #Anything for a friend!
    option = {
        name = EVTOPTC_SNB_6912

        if = {
        	limit = { is_friend = FROM }
        	reverse_opinion = {
	        	who = FROM
	        	modifier = opinion_grateful
	        	years = 10
	        }
        }

        if = {
        	limit = { NOT = { is_friend = FROM } }
        	add_friend = FROM 
        }

        back_plot = FROM

        ai_chance = {
        	factor = 10
        	modifier = {
        		OR = {
        			trait = kind
        			trait = gregarious
        			trait = socializer
        		}
        		factor = 20
        	}
        }
    }
    
    #Not interested
    option = {
        name = EVTOPTD_SNB_6912

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_disappointed
        	years = 10
        }

        ai_chance = { factor = 0 }
    }
}

#Interaction: Blackmailing superior
character_event = {
	id = SNB.6920
	hide_window = yes

	is_in_society = yes
	capable_only = yes
	prisoner = no
	min_age = 16

	is_triggered_only = yes
	
	trigger = {
		society_member_of = the_shinobi
		any_society_member = {
			same_society_as = ROOT
			block_general_event_trigger = no
			ai = yes
			higher_society_rank_than_root_trigger = yes
			NOT = { is_rival = ROOT }
			NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
		}	
	}

	immediate = {
		
		random_list = {
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_society_member = {
							same_society_as = ROOT
							block_general_event_trigger = no
							ai = yes
							higher_society_rank_than_root_trigger = yes
							NOT = { is_rival = ROOT }
							NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
							OR = {
								trait = lustful
								trait = seducer
								trait = seductress
								any_lover = { is_alive = yes }
							}
						}
					}
				}
				random_society_member = {
					limit = {
						same_society_as = ROOT
						block_general_event_trigger = no
						ai = yes
						higher_society_rank_than_root_trigger = yes
						NOT = { is_rival = ROOT }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
						OR = {
							trait = lustful
							trait = seducer
							trait = seductress
							any_lover = { is_alive = yes }
						}
					}
					save_event_target_as = shinobi_blackmail_target
					set_character_flag = blackmail_lover
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_society_member = {
							same_society_as = ROOT
							block_general_event_trigger = no
							ai = yes
							higher_society_rank_than_root_trigger = yes
							NOT = { is_rival = ROOT }
							NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
							OR = {
								trait = decadent
								trait = hedonist
								trait = gluttonous
								trait = drunkard
							}
						}
					}
				}
				random_society_member = {
					limit = {
						same_society_as = ROOT
						block_general_event_trigger = no
						ai = yes
						higher_society_rank_than_root_trigger = yes
						NOT = { is_rival = ROOT }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
						OR = {
							trait = decadent
							trait = hedonist
							trait = gluttonous
							trait = drunkard
						}
					}
					save_event_target_as = shinobi_blackmail_target
					set_character_flag = blackmail_decadence
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_society_member = {
							block_general_event_trigger = no
							same_society_as = ROOT
							ai = yes
							higher_society_rank_than_root_trigger = yes
							NOT = { is_rival = ROOT }
							NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
							OR = {
								trait = craven
								is_weak_trigger = yes
								has_disease_trigger = yes
								has_disability_trigger = yes 
								has_mental_disorder_trigger = yes
							}
						}
					}
				}
				random_society_member = {
					limit = {
						block_general_event_trigger = no
						same_society_as = ROOT
						ai = yes
						higher_society_rank_than_root_trigger = yes
						NOT = { is_rival = ROOT }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
						OR = {
							trait = craven
							is_weak_trigger = yes
							has_disease_trigger = yes
							has_disability_trigger = yes 
							has_mental_disorder_trigger = yes
						}
					}
					save_event_target_as = shinobi_blackmail_target
					set_character_flag = blackmail_weak
				}
			}
		}

		if = {
			limit = { NOT = { event_target:shinobi_blackmail_target = { always = yes } } }
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					same_society_as = ROOT
					ai = yes
					higher_society_rank_than_root_trigger = yes
					NOT = { is_rival = ROOT }
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
				}
				save_event_target_as = shinobi_blackmail_target
				set_character_flag = blackmail_decadence
			}
		}
	
		event_target:shinobi_blackmail_target = { character_event = { id = SNB.6921 } }
	}
}

character_event = {
	id = SNB.6921
	hide_window = yes
	is_triggered_only = yes
	immediate = { FROM = { character_event = { id = SNB.6922 } } }
}

#I found out their secret, what do?
character_event = {
    id = SNB.6922
    picture = GFX_evt_shady_meeting
    border = GFX_event_normal_frame_intrigue

    desc = {
    	trigger = { FROM = { has_character_flag = blackmail_decadence } }
    	text = EVTDESC_SNB_6922_A
    }
    desc = {
    	trigger = { FROM = { has_character_flag = blackmail_lover } }
    	text = EVTDESC_SNB_6922_B
    }
    desc = {
    	trigger = { FROM = { has_character_flag = blackmail_weak } }
    	text = EVTDESC_SNB_6922_C
    }

    is_triggered_only = yes

    immediate = {
    	hidden_effect = {
	    	FROM = {
	    		random_lover = { save_event_target_as = lover_of_target }
		    	if = {
		    		limit = { 
		    			has_character_flag = blackmail_lover
		    			NOT = { any_lover = { is_alive = yes } }
		    		}
		    		host = {
		    			if = {
		    				limit = { prefers_men_trigger = yes }
		    				create_random_diplomat = {
		    					female = no
		    					random_traits = yes
		    					dynasty = none
		    					age = 30
		    				}
		    				new_character = {
		    					add_lover = event_target:shinobi_blackmail_target
		    					save_event_target_as = lover_of_target
		    				}
		    			}
		    			if = {
		    				limit = { prefers_men_trigger = no }
		    				create_random_diplomat = {
		    					female = yes
		    					random_traits = yes
		    					dynasty = none
		    					age = 30
		    				}
		    				new_character = {
		    					add_lover = event_target:shinobi_blackmail_target
		    					save_event_target_as = lover_of_target
		    				}
		    			}
		    			if = {
		    				limit = { trait = homosexual }
		    				event_target:lover_of_target = { add_trait = homosexual }
		    			}
		    		}
		    	}
	    	}
    	}
    }
    
    #Promote me
    option = { 
    	trigger = {
    		society_rank < 3
    		OR = {
    			ai = no
    			society_can_rank_up = yes
    		}
    		days_at_current_society_rank = 3650
    	}
        name = EVTOPTA_SNB_6922

        society_rank_up = 1

        add_rival = FROM

        ai_chance = { factor = 100 }
    }

    #Give me some influence 
    option = {
        name = EVTOPTB_SNB_6922

       	add_society_currency_major_effect = yes

       	add_rival = FROM

       	ai_chance = { factor = 10 }
    }
    
    #I will keep your secret safe
    option = {
        name = EVTOPTD_SNB_6922

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_very_grateful 
        	years = 20
        }

        ai_chance = {
        	factor = 10
        	modifier = {
        		factor = 20
        		OR = {
        			trait = kind
        			trait = honest
        			trait = content
        			trait = just
        		}
        	}
        }
    }
}



